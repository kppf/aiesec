!function(){var define;!function(a,b,c){typeof module!="undefined"?module.exports=c(a,b):typeof define=="function"&&typeof define.amd=="object"?define(c):b[a]=c(a,b)}("bean",this,function(a,b){var c=window,d=b[a],e=/over|out/,f=/[^\.]*(?=\..*)\.|.*/,g=/\..*/,h="addEventListener",i="attachEvent",j="removeEventListener",k="detachEvent",l="ownerDocument",m="target",n="querySelectorAll",o=document||{},p=o.documentElement||{},q=p[h],r=q?h:i,s=Array.prototype.slice,t=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,u=/mouse.*(wheel|scroll)/i,v=/^text/i,w=/^touch|^gesture/i,x={},y=function(a,b,c){for(c=0;c<b.length;c++)a[b[c]]=1;return a}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange message error abort scroll "+(q?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),z=function(){function a(a){var b=a.relatedTarget;return b?b!==this&&b.prefix!=="xul"&&!/document/.test(this.toString())&&!c(b,this):b===null}var b="compareDocumentPosition",c=b in p?function(a,c){return c[b]&&(c[b](a)&16)===16}:"contains"in p?function(a,b){return b=b.nodeType===9||b===window?p:b,b!==a&&b.contains(a)}:function(a,b){while(a=a.parentNode)if(a===b)return 1;return 0};return{mouseenter:{base:"mouseover",condition:a},mouseleave:{base:"mouseout",condition:a},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),A=function(){var a="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),b=a.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),c=b.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),d=a.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),f=a.concat(["data"]),g=a.concat("touches targetTouches changedTouches scale rotation".split(" ")),h=a.concat(["data","origin","source"]),i="preventDefault",j=function(a){return function(){a[i]?a[i]():a.returnValue=!1}},k="stopPropagation",l=function(a){return function(){a[k]?a[k]():a.cancelBubble=!0}},n=function(a){return function(){a[i](),a[k](),a.stopped=!0}},q=function(a,b,c){var d,e;for(d=c.length;d--;)e=c[d],!(e in b)&&e in a&&(b[e]=a[e])};return function(r,s){var x={originalEvent:r,isNative:s};if(!r)return x;var y,z=r.type,A=r[m]||r.srcElement;x[i]=j(r),x[k]=l(r),x.stop=n(x),x[m]=A&&A.nodeType===3?A.parentNode:A;if(s){if(z.indexOf("key")!==-1)y=d,x.keyCode=r.keyCode||r.which;else if(t.test(z)){y=b,x.rightClick=r.which===3||r.button===2,x.pos={x:0,y:0};if(r.pageX||r.pageY)x.clientX=r.pageX,x.clientY=r.pageY;else if(r.clientX||r.clientY)x.clientX=r.clientX+o.body.scrollLeft+p.scrollLeft,x.clientY=r.clientY+o.body.scrollTop+p.scrollTop;e.test(z)&&(x.relatedTarget=r.relatedTarget||r[(z==="mouseover"?"from":"to")+"Element"])}else w.test(z)?y=g:u.test(z)?y=c:v.test(z)?y=f:z==="message"&&(y=h);q(r,x,y||a)}return x}}(),B=function(a,b){return!q&&!b&&(a===o||a===c)?p:a},C=function(){function a(a,b,c,d,e){var f=this.isNative=y[b]&&a[r];this.element=a,this.type=b,this.handler=c,this.original=d,this.namespaces=e,this.custom=z[b],this.eventType=q||f?b:"propertychange",this.customType=!q&&!f&&b,this[m]=B(a,f),this[r]=this[m][r]}return a.prototype={inNamespaces:function(a){var b,c;if(!a)return!0;if(!this.namespaces)return!1;for(b=a.length;b--;)for(c=this.namespaces.length;c--;)if(a[b]===this.namespaces[c])return!0;return!1},matches:function(a,b,c){return this.element===a&&(!b||this.original===b)&&(!c||this.handler===c)}},a}(),D=function(){var a={},b=function(c,d,e,f,g){if(!d||d==="*")for(var h in a)h.charAt(0)==="$"&&b(c,h.substr(1),e,f,g);else{var i=0,j,k=a["$"+d],l=c==="*";if(!k)return;for(j=k.length;i<j;i++)if(l||k[i].matches(c,e,f))if(!g(k[i],k,i,d))return}},c=function(b,c,d){var e,f=a["$"+c];if(f)for(e=f.length;e--;)if(f[e].matches(b,d,null))return!0;return!1},d=function(a,c,d){var e=[];return b(a,c,d,null,function(a){return e.push(a)}),e},e=function(b){return(a["$"+b.type]||(a["$"+b.type]=[])).push(b),b},f=function(c){b(c.element,c.type,null,c.handler,function(b,c,d){return c.splice(d,1),c.length===0&&delete a["$"+b.type],!1})},g=function(){var b,c=[];for(b in a)b.charAt(0)==="$"&&(c=c.concat(a[b]));return c};return{has:c,get:d,put:e,del:f,entries:g}}(),E=o[n]?function(a,b){return b[n](a)}:function(){throw new Error("Bean: No selector engine installed")},F=function(a){E=a},G=q?function(a,b,c,d){a[d?h:j](b,c,!1)}:function(a,b,c,d,e){e&&d&&a["_on"+e]===null&&(a["_on"+e]=0),a[d?i:k]("on"+b,c)},H=function(a,b,d){var e=b.__beanDel,f=function(f){return f=A(f||((this[l]||this.document||this).parentWindow||c).event,!0),e&&(f.currentTarget=e.ft(f[m],a)),b.apply(a,[f].concat(d))};return f.__beanDel=e,f},I=function(a,b,d,e,f,g){var h=b.__beanDel,i=function(i){var j=h?h.ft(i[m],a):this;if(e?e.apply(j,arguments):q?!0:i&&i.propertyName==="_on"+d||!i)i&&(i=A(i||((this[l]||this.document||this).parentWindow||c).event,g),i.currentTarget=j),b.apply(a,i&&(!f||f.length===0)?arguments:s.call(arguments,i?0:1).concat(f))};return i.__beanDel=h,i},J=function(a,b,c,d,e){return function(){a(b,c,e),d.apply(this,arguments)}},K=function(a,b,c,d){var e,f,h,i=b&&b.replace(g,""),j=D.get(a,i,c);for(e=0,f=j.length;e<f;e++)j[e].inNamespaces(d)&&((h=j[e])[r]&&G(h[m],h.eventType,h.handler,!1,h.type),D.del(h))},L=function(a,b,c,d,e){var h,i=b.replace(g,""),j=b.replace(f,"").split(".");if(D.has(a,i,c))return a;i==="unload"&&(c=J(K,a,i,c,d)),z[i]&&(z[i].condition&&(c=I(a,c,i,z[i].condition,e,!0)),i=z[i].base||i),h=D.put(new C(a,i,c,d,j[0]&&j)),h.handler=h.isNative?H(a,h.handler,e):I(a,h.handler,i,!1,e,!1),h[r]&&G(h[m],h.eventType,h.handler,!0,h.customType)},M=function(a,b,c){var d=function(b,d){var e,f=typeof a=="string"?c(a,d):a;for(;b&&b!==d;b=b.parentNode)for(e=f.length;e--;)if(f[e]===b)return b},e=function(a){var c=d(a[m],this);c&&b.apply(c,arguments)};return e.__beanDel={ft:d,selector:a,$:c},e},N=function(a,b,c){var d,e,h,i,j=K,k=b&&typeof b=="string";if(k&&b.indexOf(" ")>0){b=b.split(" ");for(i=b.length;i--;)N(a,b[i],c);return a}e=k&&b.replace(g,""),e&&z[e]&&(e=z[e].type);if(!b||k){if(h=k&&b.replace(f,""))h=h.split(".");j(a,e,c,h)}else if(typeof b=="function")j(a,null,b);else for(d in b)b.hasOwnProperty(d)&&N(a,d,b[d]);return a},O=function(a,b,c,d,e){var f,g,h,i,j=c,k=c&&typeof c=="string";if(b&&!c&&typeof b=="object")for(f in b)b.hasOwnProperty(f)&&O.apply(this,[a,f,b[f]]);else{i=arguments.length>3?s.call(arguments,3):[],g=(k?c:b).split(" "),k&&(c=M(b,j=d,e||E))&&(i=s.call(i,1)),this===x&&(c=J(N,a,b,c,j));for(h=g.length;h--;)L(a,g[h],c,j,i)}return a},P=function(){return O.apply(x,arguments)},Q=q?function(a,b,d){var e=o.createEvent(a?"HTMLEvents":"UIEvents");e[a?"initEvent":"initUIEvent"](b,!0,!0,c,1),d.dispatchEvent(e)}:function(a,b,c){c=B(c,a),a?c.fireEvent("on"+b,o.createEventObject()):c["_on"+b]++},R=function(a,b,c){var d,e,h,i,j,k=b.split(" ");for(d=k.length;d--;){b=k[d].replace(g,"");if(i=k[d].replace(f,""))i=i.split(".");if(!i&&!c&&a[r])Q(y[b],b,a);else{j=D.get(a,b),c=[!1].concat(c);for(e=0,h=j.length;e<h;e++)j[e].inNamespaces(i)&&j[e].handler.apply(a,c)}}return a},S=function(a,b,c){var d=0,e=D.get(b,c),f=e.length,g,h;for(;d<f;d++)e[d].original&&(h=e[d].handler.__beanDel,h?g=[a,h.selector,e[d].type,e[d].original,h.$]:g=[a,e[d].type,e[d].original],O.apply(null,g));return a},T={add:O,one:P,remove:N,clone:S,fire:R,setSelectorEngine:F,noConflict:function(){return b[a]=d,this}};if(c[i]){var U=function(){var a,b=D.entries();for(a in b)b[a].type&&b[a].type!=="unload"&&N(b[a].element,b[a].type);c[k]("onunload",U),c.CollectGarbage&&c.CollectGarbage()};c[i]("onunload",U)}return T}),!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&define.amd?define(b):this[a]=b()}("reqwest",function(){function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function eachFormElement(){var a=this,b,c,d,e=function(b,c){for(var e=0;e<c.length;e++){var f=b[byTag](c[e]);for(d=0;d<f.length;d++)serial(f[d],a)}};for(c=0;c<arguments.length;c++)b=arguments[c],/input|select|textarea/i.test(b.tagName)&&serial(b,a),e(b,["input","select","textarea"])}function serial(a,b){var c=a.name,d=a.tagName.toLowerCase(),e=function(a){a&&!a.disabled&&b(c,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&!!c)switch(d){case"input":if(!/reset|button|image|file/i.test(a.type)){var f=/checkbox/i.test(a.type),g=/radio/i.test(a.type),h=a.value;(!f&&!g||a.checked)&&b(c,normalize(f&&h===""?"on":h))}break;case"textarea":b(c,normalize(a.value));break;case"select":if(a.type.toLowerCase()==="select-one")e(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(var i=0;a.length&&i<a.length;i++)a.options[i].selected&&e(a.options[i])}}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function reqwest(a,b){return new Reqwest(a,b)}function init(o,fn){function error(a,b,c){self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(a,b,c);complete(a)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp);while(self._fulfillmentHandlers.length>0)self._fulfillmentHandlers.shift()(resp);complete(resp)}function complete(a){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(a)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&this._fulfillmentHandlers.push(function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest(o,success,error)}function setType(a){var b=a.match(/\.(json|jsonp|html|xml)(\?|$)/);return b?b[1]:"js"}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function getRequest(a,b,c){var d=(a.method||"GET").toUpperCase(),e=typeof a=="string"?a:a.url,f=a.processData!==!1&&a.data&&typeof a.data!="string"?reqwest.toQueryString(a.data):a.data||null,g;return(a.type=="jsonp"||d=="GET")&&f&&(e=urlappend(e,f),f=null),a.type=="jsonp"?handleJsonp(a,b,c,e):(g=xhr(),g.open(d,e,!0),setHeaders(g,a),setCredentials(g,a),g.onreadystatechange=handleReadyState(g,b,c),a.before&&a.before(g),g.send(f),g)}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||reqwest.getcallbackPrefix(e),h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0,l=navigator.userAgent.indexOf("MSIE 10.0")!==-1;i?i[3]==="?"?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript",j.src=d,j.async=!0,typeof j.onreadystatechange!="undefined"&&!l&&(j.event="onclick",j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){if(j[readyState]&&j[readyState]!=="complete"&&j[readyState]!=="loaded"||k)return!1;j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),a.success&&a.success(lastValue),lastValue=undefined,head.removeChild(j),k=1},head.appendChild(j)}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function generalCallback(a){lastValue=a}function setCredentials(a,b){typeof b.withCredentials!="undefined"&&typeof a.withCredentials!="undefined"&&(a.withCredentials=!!b.withCredentials)}function setHeaders(a,b){var c=b.headers||{},d;c.Accept=c.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"],!b.crossOrigin&&!c[requestedWith]&&(c[requestedWith]=defaultHeaders.requestedWith),c[contentType]||(c[contentType]=b.contentType||defaultHeaders.contentType);for(d in c)c.hasOwnProperty(d)&&a.setRequestHeader(d,c[d])}function handleReadyState(a,b,c){return function(){a&&a[readyState]==4&&(twoHundo.test(a.status)?b(a):c(a))}}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",isArray=typeof Array.isArray=="function"?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return this._fulfilled?a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(arguments.length===0)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),a=="map"?b=serializeHash:a=="array"?b=reqwest.serializeArray:b=serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a){var b="",c,d=encodeURIComponent,e=function(a,c){b+=d(a)+"="+d(c)+"&"};if(isArray(a))for(c=0;a&&c<a.length;c++)e(a[c].name,a[c].value);else for(var f in a){if(!Object.hasOwnProperty.call(a,f))continue;var g=a[f];if(isArray(g))for(c=0;c<g.length;c++)e(f,g[c]);else e(f,a[f])}return b.replace(/&$/,"").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(a){return callbackPrefix},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest})}();var Mustache=function(){function a(a){return String(a).replace(/&(?!\w+;)|[<>"']/g,function(a){return g[a]||a})}var b=Object.prototype.toString;Array.isArray=Array.isArray||function(a){return b.call(a)=="[object Array]"};var c=String.prototype.trim,d;if(c)d=function(a){return a==null?"":c.call(a)};else{var e,f;/\S/.test(" ")?(e=/^[\s\xA0]+/,f=/[\s\xA0]+$/):(e=/^\s+/,f=/\s+$/),d=function(a){return a==null?"":a.toString().replace(e,"").replace(f,"")}}var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},h={},i=function(){};return i.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(a,b,c,d){d||(this.context=b,this.buffer=[]);if(!this.includes("",a)){if(d)return a;this.send(a)}else{a=this.render_pragmas(a);var e=this.render_section(a,b,c);e===!1&&(e=this.render_tags(a,b,c,d));if(d)return e;this.sendLines(e)}},send:function(a){a!==""&&this.buffer.push(a)},sendLines:function(a){if(a){var b=a.split("\n");for(var c=0;c<b.length;c++)this.send(b[c])}},render_pragmas:function(a){if(!this.includes("%",a))return a;var b=this,c=this.getCachedRegex("render_pragmas",function(a,b){return new RegExp(a+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+b,"g")});return a.replace(c,function(a,c,d){if(!b.pragmas_implemented[c])throw{message:"This implementation of mustache doesn't understand the '"+c+"' pragma"};b.pragmas[c]={};if(d){var e=d.split("=");b.pragmas[c][e[0]]=e[1]}return""})},render_partial:function(a,b,c){a=d(a);if(!c||c[a]===undefined)throw{message:"unknown_partial '"+a+"'"};return!b||typeof b[a]!="object"?this.render(c[a],b,c,!0):this.render(c[a],b[a],c,!0)},render_section:function(a,b,c){if(!this.includes("#",a)&&!this.includes("^",a))return!1;var d=this,e=this.getCachedRegex("render_section",function(a,b){return new RegExp("^([\\s\\S]*?)"+a+"(\\^|\\#)\\s*(.+)\\s*"+b+"\n*([\\s\\S]*?)"+a+"\\/\\s*\\3\\s*"+b+"\\s*([\\s\\S]*)$","g")});return a.replace(e,function(a,e,f,g,h,i){var j=e?d.render_tags(e,b,c,!0):"",k=i?d.render(i,b,c,!0):"",l,m=d.find(g,b);return f==="^"?!m||Array.isArray(m)&&m.length===0?l=d.render(h,b,c,!0):l="":f==="#"&&(Array.isArray(m)?l=d.map(m,function(a){return d.render(h,d.create_context(a),c,!0)}).join(""):d.is_object(m)?l=d.render(h,d.create_context(m),c,!0):typeof m=="function"?l=m.call(b,h,function(a){return d.render(a,b,c,!0)}):m?l=d.render(h,b,c,!0):l=""),j+l+k})},render_tags:function(b,c,d,e){var f=this,g=function(){return f.getCachedRegex("render_tags",function(a,b){return new RegExp(a+"(=|!|>|&|\\{|%)?([^#\\^]+?)\\1?"+b+"+","g")})},h=g(),i=function(b,e,i){switch(e){case"!":return"";case"=":return f.set_delimiters(i),h=g(),"";case">":return f.render_partial(i,c,d);case"{":case"&":return f.find(i,c);default:return a(f.find(i,c))}},j=b.split("\n");for(var k=0;k<j.length;k++)j[k]=j[k].replace(h,i,this),e||this.send(j[k]);if(e)return j.join("\n")},set_delimiters:function(a){var b=a.split(" ");this.otag=this.escape_regex(b[0]),this.ctag=this.escape_regex(b[1])},escape_regex:function(a){if(!arguments.callee.sRE){var b=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+b.join("|\\")+")","g")}return a.replace(arguments.callee.sRE,"\\$1")},find:function(a,b){function c(a){return a===!1||a===0||a}a=d(a);var e;if(a.match(/([a-z_]+)\./ig)){var f=this.walk_context(a,b);c(f)&&(e=f)}else c(b[a])?e=b[a]:c(this.context[a])&&(e=this.context[a]);return typeof e=="function"?e.apply(b):e!==undefined?e:""},walk_context:function(a,b){var c=a.split("."),d=b[c[0]]!=undefined?b:this.context,e=d[c.shift()];while(e!=undefined&&c.length>0)d=e,e=e[c.shift()];return typeof e=="function"?e.apply(d):e},includes:function(a,b){return b.indexOf(this.otag+a)!=-1},create_context:function(a){if(this.is_object(a))return a;var b=".";this.pragmas["IMPLICIT-ITERATOR"]&&(b=this.pragmas["IMPLICIT-ITERATOR"].iterator);var c={};return c[b]=a,c},is_object:function(a){return a&&typeof a=="object"},map:function(a,b){if(typeof a.map=="function")return a.map(b);var c=[],d=a.length;for(var e=0;e<d;e++)c.push(b(a[e]));return c},getCachedRegex:function(a,b){var c=h[this.otag];c||(c=h[this.otag]={});var d=c[this.ctag];d||(d=c[this.ctag]={});var e=d[a];return e||(e=d[a]=b(this.otag,this.ctag)),e}},{name:"mustache.js",version:"0.4.0",to_html:function(a,b,c,d){var e=new i;d&&(e.send=d),e.render(a,b||{},c);if(!d)return e.buffer.join("\n")}}}();typeof module!="undefined"&&module.exports&&(exports.name=Mustache.name,exports.version=Mustache.version,exports.to_html=function(){return Mustache.to_html.apply(this,arguments)});var previousMM=MM;if(!com){var com={};com.modestmaps||(com.modestmaps={})}var MM=com.modestmaps={noConflict:function(){return MM=previousMM,this}};(function(a){a.extend=function(a,b){for(var c in b.prototype)typeof a.prototype[c]=="undefined"&&(a.prototype[c]=b.prototype[c]);return a},a.getFrame=function(){return function(a){(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(function(){a(+(new Date))},10)})(a)}}(),a.transformProperty=function(a){if(!!this.document){var b=document.documentElement.style;for(var c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1}}(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),a.matrixString=function(b){b.scale*b.width%1&&(b.scale+=(1-b.scale*b.width%1)/b.width);var c=b.scale||1;return a._browser.webkit3d?"translate3d("+b.x.toFixed(0)+"px,"+b.y.toFixed(0)+"px, 0px)"+"scale3d("+c+","+c+", 1)":"translate("+b.x.toFixed(6)+"px,"+b.y.toFixed(6)+"px)"+"scale("+c+","+c+")"},a._browser=function(a){return{webkit:"WebKitCSSMatrix"in a,webkit3d:"WebKitCSSMatrix"in a&&"m11"in new WebKitCSSMatrix}}(this),a.moveElement=function(b,c){if(a.transformProperty){c.scale||(c.scale=1),c.width||(c.width=0),c.height||(c.height=0);var d=a.matrixString(c);b[a.transformProperty]!==d&&(b.style[a.transformProperty]=b[a.transformProperty]=d)}else b.style.left=c.x+"px",b.style.top=c.y+"px",c.width&&c.height&&c.scale&&(b.style.width=Math.ceil(c.width*c.scale)+"px",b.style.height=Math.ceil(c.height*c.scale)+"px")},a.cancelEvent=function(a){return a.cancelBubble=!0,a.cancel=!0,a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),!1},a.coerceLayer=function(b){return typeof b=="string"?new a.Layer(new a.TemplatedLayer(b)):"draw"in b&&typeof b.draw=="function"?b:new a.Layer(b)},a.addEvent=function(a,b,c){a.addEventListener?(a.addEventListener(b,c,!1),b=="mousewheel"&&a.addEventListener("DOMMouseScroll",c,!1)):a.attachEvent&&(a["e"+b+c]=c,a[b+c]=function(){a["e"+b+c](window.event)},a.attachEvent("on"+b,a[b+c]))},a.removeEvent=function(a,b,c){a.removeEventListener?(a.removeEventListener(b,c,!1),b=="mousewheel"&&a.removeEventListener("DOMMouseScroll",c,!1)):a.detachEvent&&(a.detachEvent("on"+b,a[b+c]),a[b+c]=null)},a.getStyle=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)},a.Point=function(a,b){this.x=parseFloat(a),this.y=parseFloat(b)},a.Point.prototype={x:0,y:0,toString:function(){return"("+this.x.toFixed(3)+", "+this.y.toFixed(3)+")"},copy:function(){return new a.Point(this.x,this.y)}},a.Point.distance=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},a.Point.interpolate=function(b,c,d){return new a.Point(b.x+(c.x-b.x)*d,b.y+(c.y-b.y)*d)},a.Coordinate=function(a,b,c){this.row=a,this.column=b,this.zoom=c},a.Coordinate.prototype={row:0,column:0,zoom:0,toString:function(){return"("+this.row.toFixed(3)+", "+this.column.toFixed(3)+" @"+this.zoom.toFixed(3)+")"},toKey:function(){return this.zoom+","+this.row+","+this.column},copy:function(){return new a.Coordinate(this.row,this.column,this.zoom)},container:function(){return new a.Coordinate(Math.floor(this.row),Math.floor(this.column),Math.floor(this.zoom))},zoomTo:function(b){var c=Math.pow(2,b-this.zoom);return new a.Coordinate(this.row*c,this.column*c,b)},zoomBy:function(b){var c=Math.pow(2,b);return new a.Coordinate(this.row*c,this.column*c,this.zoom+b)},up:function(b){return b===undefined&&(b=1),new a.Coordinate(this.row-b,this.column,this.zoom)},right:function(b){return b===undefined&&(b=1),new a.Coordinate(this.row,this.column+b,this.zoom)},down:function(b){return b===undefined&&(b=1),new a.Coordinate(this.row+b,this.column,this.zoom)},left:function(b){return b===undefined&&(b=1),new a.Coordinate(this.row,this.column-b,this.zoom)}},a.Location=function(a,b){this.lat=parseFloat(a),this.lon=parseFloat(b)},a.Location.prototype={lat:0,lon:0,toString:function(){return"("+this.lat.toFixed(3)+", "+this.lon.toFixed(3)+")"},copy:function(){return new a.Location(this.lat,this.lon)}},a.Location.distance=function(a,b,c){c||(c=6378e3);var d=Math.PI/180,e=a.lat*d,f=a.lon*d,g=b.lat*d,h=b.lon*d,i=Math.cos(e)*Math.cos(f)*Math.cos(g)*Math.cos(h),j=Math.cos(e)*Math.sin(f)*Math.cos(g)*Math.sin(h),k=Math.sin(e)*Math.sin(g);return Math.acos(i+j+k)*c},a.Location.interpolate=function(b,c,d){if(b.lat===c.lat&&b.lon===c.lon)return new a.Location(b.lat,b.lon);var f=Math.PI/180,g=b.lat*f,h=b.lon*f,i=c.lat*f,j=c.lon*f,k=2*Math.asin(Math.sqrt(Math.pow(Math.sin((g-i)/2),2)+Math.cos(g)*Math.cos(i)*Math.pow(Math.sin((h-j)/2),2))),l=Math.sin((1-d)*k)/Math.sin(k),m=Math.sin(d*k)/Math.sin(k),n=l*Math.cos(g)*Math.cos(h)+m*Math.cos(i)*Math.cos(j),o=l*Math.cos(g)*Math.sin(h)+m*Math.cos(i)*Math.sin(j),p=l*Math.sin(g)+m*Math.sin(i),q=Math.atan2(p,Math.sqrt(Math.pow(n,2)+Math.pow(o,2))),r=Math.atan2(o,n);return new a.Location(q/f,r/f)},a.Location.bearing=function(a,b){var c=Math.PI/180,d=a.lat*c,e=a.lon*c,f=b.lat*c,g=b.lon*c,h=Math.atan2(Math.sin(e-g)*Math.cos(f),Math.cos(d)*Math.sin(f)-Math.sin(d)*Math.cos(f)*Math.cos(e-g))/-(Math.PI/180);return h<0?h+360:h},a.Extent=function(b,c,d,f){if(b instanceof a.Location&&c instanceof a.Location){var g=b,h=c;b=g.lat,c=g.lon,d=h.lat,f=h.lon}isNaN(d)&&(d=b),isNaN(f)&&(f=c),this.north=Math.max(b,d),this.south=Math.min(b,d),this.east=Math.max(f,c),this.west=Math.min(f,c)},a.Extent.prototype={north:0,south:0,east:0,west:0,copy:function(){return new a.Extent(this.north,this.west,this.south,this.east)},toString:function(a){return isNaN(a)&&(a=3),[this.north.toFixed(a),this.west.toFixed(a),this.south.toFixed(a),this.east.toFixed(a)].join(", ")},northWest:function(){return new a.Location(this.north,this.west)},southEast:function(){return new a.Location(this.south,this.east)},northEast:function(){return new a.Location(this.north,this.east)},southWest:function(){return new a.Location(this.south,this.west)},center:function(){return new a.Location(this.south+(this.north-this.south)/2,this.east+(this.west-this.east)/2)},encloseLocation:function(a){a.lat>this.north&&(this.north=a.lat),a.lat<this.south&&(this.south=a.lat),a.lon>this.east&&(this.east=a.lon),a.lon<this.west&&(this.west=a.lon)},encloseLocations:function(a){var b=a.length;for(var c=0;c<b;c++)this.encloseLocation(a[c])},setFromLocations:function(a){var b=a.length,c=a[0];this.north=this.south=c.lat,this.east=this.west=c.lon;for(var d=1;d<b;d++)this.encloseLocation(a[d])},encloseExtent:function(a){a.north>this.north&&(this.north=a.north),a.south<this.south&&(this.south=a.south),a.east>this.east&&(this.east=a.east),a.west<this.west&&(this.west=a.west)},containsLocation:function(a){return a.lat>=this.south&&a.lat<=this.north&&a.lon>=this.west&&a.lon<=this.east},toArray:function(){return[this.northWest(),this.southEast()]}},a.Extent.fromString=function(b){var c=b.split(/\s*,\s*/);if(c.length!=4)throw"Invalid extent string (expecting 4 comma-separated numbers)";return new a.Extent(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]))},a.Extent.fromArray=function(b){var c=new a.Extent;return c.setFromLocations(b),c},a.Transformation=function(a,b,c,d,e,f){this.ax=a,this.bx=b,this.cx=c,this.ay=d,this.by=e,this.cy=f},a.Transformation.prototype={ax:0,bx:0,cx:0,ay:0,by:0,cy:0,transform:function(b){return new a.Point(this.ax*b.x+this.bx*b.y+this.cx,this.ay*b.x+this.by*b.y+this.cy)},untransform:function(b){return new a.Point((b.x*this.by-b.y*this.bx-this.cx*this.by+this.cy*this.bx)/(this.ax*this.by-this.ay*this.bx),(b.x*this.ay-b.y*this.ax-this.cx*this.ay+this.cy*this.ax)/(this.bx*this.ay-this.by*this.ax))}},a.deriveTransformation=function(b,c,d,f,g,h,i,j,k,l,m,n){var o=a.linearSolution(b,c,d,g,h,i,k,l,m),p=a.linearSolution(b,c,f,g,h,j,k,l,n);return new a.Transformation(o[0],o[1],o[2],p[0],p[1],p[2])},a.linearSolution=function(a,b,c,d,e,f,g,h,i){a=parseFloat(a),b=parseFloat(b),c=parseFloat(c),d=parseFloat(d),e=parseFloat(e),f=parseFloat(f),g=parseFloat(g),h=parseFloat(h),i=parseFloat(i);var j=((f-i)*(b-e)-(c-f)*(e-h))/((d-g)*(b-e)-(a-d)*(e-h)),k=((f-i)*(a-d)-(c-f)*(d-g))/((e-h)*(a-d)-(b-e)*(d-g)),l=c-a*j-b*k;return[j,k,l]},a.Projection=function(b,c){c||(c=new a.Transformation(1,0,0,0,1,0)),this.zoom=b,this.transformation=c},a.Projection.prototype={zoom:0,transformation:null,rawProject:function(a){throw"Abstract method not implemented by subclass."},rawUnproject:function(a){throw"Abstract method not implemented by subclass."},project:function(a){return a=this.rawProject(a),this.transformation&&(a=this.transformation.transform(a)),a},unproject:function(a){return this.transformation&&(a=this.transformation.untransform(a)),a=this.rawUnproject(a),a},locationCoordinate:function(b){var c=new a.Point(Math.PI*b.lon/180,Math.PI*b.lat/180);return c=this.project(c),new a.Coordinate(c.y,c.x,this.zoom)},coordinateLocation:function(b){b=b.zoomTo(this.zoom);var c=new a.Point(b.column,b.row);return c=this.unproject(c),new a.Location(180*c.y/Math.PI,180*c.x/Math.PI)}},a.LinearProjection=function(b,c){a.Projection.call(this,b,c)},a.LinearProjection.prototype={rawProject:function(b){return new a.Point(b.x,b.y)},rawUnproject:function(b){return new a.Point(b.x,b.y)}},a.extend(a.LinearProjection,a.Projection),a.MercatorProjection=function(b,c){a.Projection.call(this,b,c)},a.MercatorProjection.prototype={rawProject:function(b){return new a.Point(b.x,Math.log(Math.tan(.25*Math.PI+.5*b.y)))},rawUnproject:function(b){return new a.Point(b.x,2*Math.atan(Math.pow(Math.E,b.y))-.5*Math.PI)}},a.extend(a.MercatorProjection,a.Projection),a.MapProvider=function(a){a&&(this.getTile=a)},a.MapProvider.prototype={tileLimits:[new a.Coordinate(0,0,0),(new a.Coordinate(1,1,0)).zoomTo(18)],getTileUrl:function(a){throw"Abstract method not implemented by subclass."},getTile:function(a){throw"Abstract method not implemented by subclass."},releaseTile:function(a){},setZoomRange:function(a,b){this.tileLimits[0]=this.tileLimits[0].zoomTo(a),this.tileLimits[1]=this.tileLimits[1].zoomTo(b)},sourceCoordinate:function(b){var c=this.tileLimits[0].zoomTo(b.zoom).container(),d=this.tileLimits[1].zoomTo(b.zoom),f=Math.pow(2,b.zoom),g;return d=new a.Coordinate(Math.ceil(d.row),Math.ceil(d.column),Math.floor(d.zoom)),b.column<0?g=(b.column%f+f)%f:g=b.column%f,b.row<c.row||b.row>=d.row?null:g<c.column||g>=d.column?null:new a.Coordinate(b.row,g,b.zoom)}},a.Template=function(b,c){function d(a,b,c){var d="";for(var e=1;e<=c;e++)d+=(a>>c-e&1)<<1|b>>c-e&1;return d||"0"}var f=b.match(/{(Q|quadkey)}/);f&&(b=b.replace("{subdomains}","{S}").replace("{zoom}","{Z}").replace("{quadkey}","{Q}"));var g=c&&c.length&&b.indexOf("{S}")>=0,h=function(a){var e=this.sourceCoordinate(a);if(!e)return null;var h=b;if(g){var j=parseInt(e.zoom+e.row+e.column,10)%c.length;h=h.replace("{S}",c[j])}return f?h.replace("{Z}",e.zoom.toFixed(0)).replace("{Q}",d(e.row,e.column,e.zoom)):h.replace("{Z}",e.zoom.toFixed(0)).replace("{X}",e.column.toFixed(0)).replace("{Y}",e.row.toFixed(0))};a.MapProvider.call(this,h)},a.Template.prototype={getTile:function(a){return this.getTileUrl(a)}},a.extend(a.Template,a.MapProvider),a.TemplatedLayer=function(b,c,d){return new a.Layer(new a.Template(b,c),null,d)},a.getMousePoint=function(b,c){var d=new a.Point(b.clientX,b.clientY);d.x+=document.body.scrollLeft+document.documentElement.scrollLeft,d.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var f=c.parent;f;f=f.offsetParent)d.x-=f.offsetLeft,d.y-=f.offsetTop;return d},a.MouseWheelHandler=function(){function b(b){var c=0;g=g||(new Date).getTime();try{f.scrollTop=1e3,f.dispatchEvent(b),c=1e3-f.scrollTop}catch(j){c=b.wheelDelta||-b.detail*5}var k=(new Date).getTime()-g,l=a.getMousePoint(b,d);return Math.abs(c)>0&&k>200&&!h?(d.zoomByAbout(c>0?1:-1,l),g=(new Date).getTime()):h&&d.zoomByAbout(c*.001,l),a.cancelEvent(b)}var c={},d,f,g,h=!1;return c.init=function(g){d=g,f=document.body.appendChild(document.createElement("div")),f.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var h=f.appendChild(document.createElement("div"));return h.style.height="2000px",a.addEvent(d.parent,"mousewheel",b),c},c.precise=function(a){return arguments.length?(h=a,c):h},c.remove=function(){a.removeEvent(d.parent,"mousewheel",b),f.parentNode.removeChild(f)},c},a.DoubleClickHandler=function(){function b(b){var c=a.getMousePoint(b,d);return d.zoomByAbout(b.shiftKey?-1:1,c),a.cancelEvent(b)}var c={},d;return c.init=function(f){return d=f,a.addEvent(d.parent,"dblclick",b),c},c.remove=function(){a.removeEvent(d.parent,"dblclick",b)},c},a.DragHandler=function(){function d(b){return g&&(h.panBy(b.clientX-g.x,b.clientY-g.y),g.x=b.clientX,g.y=b.clientY,g.t=+(new Date)),a.cancelEvent(b)}function c(b){return a.removeEvent(document,"mouseup",c),a.removeEvent(document,"mousemove",d),g=null,h.parent.style.cursor="",a.cancelEvent(b)}function b(b){if(!b.shiftKey&&b.button!=2)return a.addEvent(document,"mouseup",c),a.addEvent(document,"mousemove",d),g=new a.Point(b.clientX,b.clientY),h.parent.style.cursor="move",a.cancelEvent(b)}var f={},g,h;return f.init=function(c){return h=c,a.addEvent(h.parent,"mousedown",b),f},f.remove=function(){a.removeEvent(h.parent,"mousedown",b)},f},a.MouseHandler=function(){var b={},c,d;return b.init=function(f){return c=f,d=[a.DragHandler().init(c),a.DoubleClickHandler().init(c),a.MouseWheelHandler().init(c)],b},b.remove=function(){for(var a=0;a<d.length;a++)d[a].remove();return b},b},a.TouchHandler=function(){function n(a){if(v){var b=p.getZoom(),c=Math.round(b);p.zoomByAbout(c-b,a)}w=!1}function m(b){var c=b.touches[0],d=b.touches[1],f=new a.Point(c.clientX,c.clientY),g=new a.Point(d.clientX,d.clientY),h=t[c.identifier],i=t[d.identifier];h.wasPinch=!0,i.wasPinch=!0;var j=a.Point.interpolate(f,g,.5);p.zoomByAbout(Math.log(b.scale)/Math.LN2-Math.log(h.scale)/Math.LN2,j);var k=a.Point.interpolate(h,i,.5);p.panBy(j.x-k.x,j.y-k.y),w=!0,x=j}function l(a){var b={x:a.clientX,y:a.clientY},c=t[a.identifier];p.panBy(b.x-c.x,b.y-c.y)}function k(b){var c=p.getZoom(),d=Math.round(c)+1,f=d-c,g=new a.Point(b.x,b.y);p.zoomByAbout(f,g)}function j(a){u.length&&a.time-u[0].time<s?(k(a),u=[]):u=[a]}function i(a){}function h(b){var c=(new Date).getTime();b.touches.length===0&&w&&n(x);for(var d=0;d<b.changedTouches.length;d+=1){var f=b.changedTouches[d],g=t[f.identifier];if(!g||g.wasPinch)continue;var h={x:f.clientX,y:f.clientY},k=c-g.time,l=a.Point.distance(h,g.startPos);l>r||(k>q?(h.end=c,h.duration=k,i(h)):(h.time=c,j(h)))}var m={};for(var o=0;o<b.touches.length;o++)m[b.touches[o].identifier]=!0;for(var p in t)p in m||delete m[p];return a.cancelEvent(b)}function g(b){switch(b.touches.length){case 1:l(b.touches[0]);break;case 2:m(b)}return c(b),a.cancelEvent(b)}function f(a){c(a)}function d(a,b){return a&&a.touch&&b.identifier==a.touch.identifier}function c(a){for(var b=0;b<a.touches.length;b+=1){var c=a.touches[b];if(c.identifier in t){var d=t[c.identifier];d.x=c.clientX,d.y=c.clientY,d.scale=a.scale}else t[c.identifier]={scale:a.scale,startPos:{x:c.clientX,y:c.clientY},x:c.clientX,y:c.clientY,time:(new Date).getTime()}}}function b(){var a=document.createElement("div");return a.setAttribute("ongesturestart","return;"),typeof a.ongesturestart=="function"}var o={},p,q=250,r=30,s=350,t={},u=[],v=!0,w=!1,x=null;return o.init=function(c){return p=c,b()?(a.addEvent(p.parent,"touchstart",f),a.addEvent(p.parent,"touchmove",g),a.addEvent(p.parent,"touchend",h),o):o},o.remove=function(){return b()?(a.removeEvent(p.parent,"touchstart",f),a.removeEvent(p.parent,"touchmove",g),a.removeEvent(p.parent,"touchend",h),o):o},o},a.CallbackManager=function(a,b){this.owner=a,this.callbacks={};for(var c=0;c<b.length;c++)this.callbacks[b[c]]=[]},a.CallbackManager.prototype={owner:null,callbacks:null,addCallback:function(a,b){typeof b=="function"&&this.callbacks[a]&&this.callbacks[a].push(b)},removeCallback:function(a,b){if(typeof b=="function"&&this.callbacks[a]){var c=this.callbacks[a],d=c.length;for(var e=0;e<d;e++)if(c[e]===b){c.splice(e,1);break}}},dispatchCallback:function(a,b){if(this.callbacks[a])for(var c=0;c<this.callbacks[a].length;c+=1)try{this.callbacks[a][c](this.owner,b)}catch(d){}}},a.RequestManager=function(){this.loadingBay=document.createDocumentFragment(),this.requestsById={},this.openRequestCount=0,this.maxOpenRequests=4,this.requestQueue=[],this.callbackManager=new a.CallbackManager(this,["requestcomplete","requesterror"])},a.RequestManager.prototype={loadingBay:null,requestsById:null,requestQueue:null,openRequestCount:null,maxOpenRequests:null,callbackManager:null,addCallback:function(a,b){this.callbackManager.addCallback(a,b)},removeCallback:function(a,b){this.callbackManager.removeCallback(a,b)},dispatchCallback:function(a,b){this.callbackManager.dispatchCallback(a,b)},clear:function(){this.clearExcept({})},clearRequest:function(a){a in this.requestsById&&delete this.requestsById[a];for(var b=0;b<this.requestQueue.length;b++){var c=this.requestQueue[b];c&&c.id==a&&(this.requestQueue[b]=null)}},clearExcept:function(a){for(var b=0;b<this.requestQueue.length;b++){var c=this.requestQueue[b];c&&!(c.id in a)&&(this.requestQueue[b]=null)}var d=this.loadingBay.childNodes;for(var e=d.length-1;e>=0;e--){var f=d[e];f.id in a||(this.loadingBay.removeChild(f),this.openRequestCount--,f.src=f.coord=f.onload=f.onerror=null)}for(var g in this.requestsById)if(!(g in a)&&this.requestsById.hasOwnProperty(g)){var h=this.requestsById[g];delete this.requestsById[g],h!==null&&(h=h.id=h.coord=h.url=null)}},hasRequest:function(a){return a in this.requestsById},requestTile:function(a,b,c){if(!(a in this.requestsById)){var d={id:a,coord:b.copy(),url:c};this.requestsById[a]=d,c&&this.requestQueue.push(d)}},getProcessQueue:function(){if(!this._processQueue){var a=this;this._processQueue=function(){a.processQueue()}}return this._processQueue},processQueue:function(a){a&&this.requestQueue.length>8&&this.requestQueue.sort(a);while(this.openRequestCount<this.maxOpenRequests&&this.requestQueue.length>0){var b=this.requestQueue.pop();if(b){this.openRequestCount++;var c=document.createElement("img");c.id=b.id,c.style.position="absolute",c.coord=b.coord,this.loadingBay.appendChild(c),c.onload=c.onerror=this.getLoadComplete(),c.src=b.url,b=b.id=b.coord=b.url=null}}},_loadComplete:null,getLoadComplete:function(){if(!this._loadComplete){var a=this;this._loadComplete=function(b){b=b||window.event;var c=b.srcElement||b.target;c.onload=c.onerror=null,a.loadingBay.removeChild(c),a.openRequestCount--,delete a.requestsById[c.id],b.type==="load"&&(c.complete||c.readyState&&c.readyState=="complete")?a.dispatchCallback("requestcomplete",c):(a.dispatchCallback("requesterror",{element:c,url:""+c.src}),c.src=null),setTimeout(a.getProcessQueue(),0)}}return this._loadComplete}},a.Layer=function(b,c,d){this.parent=c||document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.name=d,this.levels={},this.requestManager=new a.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),b&&this.setProvider(b)},a.Layer.prototype={map:null,parent:null,name:null,enabled:!0,tiles:null,levels:null,requestManager:null,provider:null,_tileComplete:null,getTileComplete:function(){if(!this._tileComplete){var a=this;this._tileComplete=function(b,c){a.tiles[c.id]=c,a.positionTile(c)}}return this._tileComplete},getTileError:function(){if(!this._tileError){var a=this;this._tileError=function(b,c){c.element.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",a.tiles[c.element.id]=c.element,a.positionTile(c.element)}}return this._tileError},draw:function(){function b(a,b){if(a&&b){var d=a.coord,e=b.coord;if(d.zoom==e.zoom){var f=Math.abs(c.row-d.row-.5)+Math.abs(c.column-d.column-.5),g=Math.abs(c.row-e.row-.5)+Math.abs(c.column-e.column-.5);return f<g?1:f>g?-1:0}return d.zoom<e.zoom?1:d.zoom>e.zoom?-1:0}return a?1:b?-1:0}if(!!this.enabled&&!!this.map){var c=this.map.coordinate.zoomTo(Math.round(this.map.coordinate.zoom)),d=Math.round(this.map.coordinate.zoom),f=this.map.pointCoordinate(new a.Point(0,0)).zoomTo(d).container(),g=this.map.pointCoordinate(this.map.dimensions).zoomTo(d).container().right().down(),h={},i=this.createOrGetLevel(f.zoom),j=f.copy();for(j.column=f.column;j.column<=g.column;j.column++)for(j.row=f.row;j.row<=g.row;j.row++){var k=this.inventoryVisibleTile(i,j);while(k.length)h[k.pop()]=!0}for(var l in this.levels)if(this.levels.hasOwnProperty(l)){var m=parseInt(l,10);if(m>=f.zoom-5&&m<f.zoom+2)continue;var n=this.levels[l];n.style.display="none";var o=this.tileElementsInLevel(n);while(o.length)this.provider.releaseTile(o[0].coord),this.requestManager.clearRequest(o[0].coord.toKey()),n.removeChild(o[0]),o.shift()}var p=f.zoom-5,q=f.zoom+2;for(var r=p;r<q;r++)this.adjustVisibleLevel(this.levels[r],r,h);this.requestManager.clearExcept(h),this.requestManager.processQueue(b)}},inventoryVisibleTile:function(a,b){var c=b.toKey(),d=[c];if(c in this.tiles){var e=this.tiles[c];return e.parentNode!=a&&(a.appendChild(e),"reAddTile"in this.provider&&this.provider.reAddTile(c,b,e)),d}if(!this.requestManager.hasRequest(c)){var f=this.provider.getTile(b);typeof f=="string"?this.addTileImage(c,b,f):f&&this.addTileElement(c,b,f)}var g=!1,h=b.zoom;for(var i=1;i<=h;i++){var j=b.zoomBy(-i).container(),k=j.toKey();if(k in this.tiles){d.push(k),g=!0;break}}if(!g){var l=b.zoomBy(1);d.push(l.toKey()),l.column+=1,d.push(l.toKey()),l.row+=1,d.push(l.toKey()),l.column-=1,d.push(l.toKey())}return d},tileElementsInLevel:function(a){var b=[];for(var c=a.firstChild;c;c=c.nextSibling)c.nodeType==1&&b.push(c);return b},adjustVisibleLevel:function(b,c,d){if(!!b){var f=1,g=this.map.coordinate.copy();if(!(b.childNodes.length>0))return b.style.display="none",!1;b.style.display="block",f=Math.pow(2,this.map.coordinate.zoom-c),g=g.zoomTo(c);var h=this.map.tileSize.x*f,i=this.map.tileSize.y*f,j=new a.Point(this.map.dimensions.x/2,this.map.dimensions.y/2),k=this.tileElementsInLevel(b);while(k.length){var l=k.pop();d[l.id]?a.moveElement(l,{x:Math.round(j.x+(l.coord.column-g.column)*h),y:Math.round(j.y+(l.coord.row-g.row)*i),scale:f,width:this.map.tileSize.x,height:this.map.tileSize.y}):(this.provider.releaseTile(l.coord),this.requestManager.clearRequest(l.coord.toKey()),b.removeChild(l))}}},createOrGetLevel:function(a){if(a in this.levels)return this.levels[a];var b=document.createElement("div");return b.id=this.parent.id+"-zoom-"+a,b.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0;",b.style.zIndex=a,this.parent.appendChild(b),this.levels[a]=b,b},addTileImage:function(a,b,c){this.requestManager.requestTile(a,b,c)},addTileElement:function(a,b,c){c.id=a,c.coord=b.copy(),this.positionTile(c)},positionTile:function(b){var c=this.map.coordinate.zoomTo(b.coord.zoom);b.style.cssText="position:absolute;-webkit-user-select:none;-webkit-user-drag:none;-moz-user-drag:none;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;-ms-transform-origin:0 0;width:"+this.map.tileSize.x+"px; height: "+this.map.tileSize.y+"px;",b.ondragstart=function(){return!1};var d=Math.pow(2,this.map.coordinate.zoom-b.coord.zoom);a.moveElement(b,{x:Math.round(this.map.dimensions.x/2+(b.coord.column-c.column)*this.map.tileSize.x),y:Math.round(this.map.dimensions.y/2+(b.coord.row-c.row)*this.map.tileSize.y),scale:d,width:this.map.tileSize.x,height:this.map.tileSize.y});var f=this.levels[b.coord.zoom];f.appendChild(b),b.className="map-tile-loaded",Math.round(this.map.coordinate.zoom)==b.coord.zoom&&(f.style.display="block"),this.requestRedraw()},_redrawTimer:undefined,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var a=this;this._redraw=function(){a.draw(),a._redrawTimer=0}}return this._redraw},setProvider:function(a){var b=this.provider===null;if(!b){this.requestManager.clear();for(var c in this.levels)if(this.levels.hasOwnProperty(c)){var d=this.levels[c];while(d.firstChild)this.provider.releaseTile(d.firstChild.coord),d.removeChild(d.firstChild)}}this.tiles={},this.provider=a,b||this.draw()},enable:function(){this.enabled=!0,this.parent.style.display="",this.draw()},disable:function(){this.enabled=!1,this.requestManager.clear(),this.parent.style.display="none"},destroy:function(){this.requestManager.clear(),this.requestManager.removeCallback("requestcomplete",this.getTileComplete()),this.requestManager.removeCallback("requesterror",this.getTileError()),this.provider=null,this.parent.parentNode&&this.parent.parentNode.removeChild(this.parent),this.map=null}},a.Map=function(b,c,d,f){if(typeof b=="string"){b=document.getElementById(b);if(!b)throw"The ID provided to modest maps could not be found."}this.parent=b,this.parent.style.padding="0",this.parent.style.overflow="hidden";var g=a.getStyle(this.parent,"position");g!="relative"&&g!="absolute"&&(this.parent.style.position="relative"),this.layers=[],c||(c=[]),c instanceof Array||(c=[c]);for(var h=0;h<c.length;h++)this.addLayer(c[h]);this.projection=new a.MercatorProjection(0,a.deriveTransformation(-Math.PI,Math.PI,0,0,Math.PI,Math.PI,1,0,-Math.PI,-Math.PI,0,1)),this.tileSize=new a.Point(256,256),this.coordLimits=[new a.Coordinate(0,-Infinity,0),(new a.Coordinate(1,Infinity,0)).zoomTo(18)],this.coordinate=new a.Coordinate(.5,.5,0),d?(this.autoSize=!1,this.parent.style.width=Math.round(d.x)+"px",this.parent.style.height=Math.round(d.y)+"px"):(d=new a.Point(this.parent.offsetWidth,this.parent.offsetHeight),this.autoSize=!0,a.addEvent(window,"resize",this.windowResize())),this.dimensions=d,this.callbackManager=new a.CallbackManager(this,["zoomed","panned","centered","extentset","resized","drawn"]);if(f===undefined)this.eventHandlers=[a.MouseHandler().init(this),a.TouchHandler().init(this)];else{this.eventHandlers=f;if(f instanceof Array)for(var i=0;i<f.length;i++)f[i].init(this)}},a.Map.prototype={parent:null,dimensions:null,projection:null,coordinate:null,tileSize:null,coordLimits:null,layers:null,callbackManager:null,eventHandlers:null,autoSize:null,toString:function(){return"Map(#"+this.parent.id+")"},addCallback:function(a,b){return this.callbackManager.addCallback(a,b),this},removeCallback:function(a,b){return this.callbackManager.removeCallback(a,b),this},dispatchCallback:function(a,b){return this.callbackManager.dispatchCallback(a,b),this},windowResize:function(){if(!this._windowResize){var b=this;this._windowResize=function(c){b.dimensions=new a.Point(b.parent.offsetWidth,b.parent.offsetHeight),b.draw(),b.dispatchCallback("resized",[b.dimensions])}}return this._windowResize},setZoomRange:function(a,b){return this.coordLimits[0]=this.coordLimits[0].zoomTo(a),this.coordLimits[1]=this.coordLimits[1].zoomTo(b),this},zoomBy:function(b){return this.coordinate=this.enforceLimits(this.coordinate.zoomBy(b)),a.getFrame(this.getRedraw()),this.dispatchCallback("zoomed",b),this},zoomIn:function(){return this.zoomBy(1)},zoomOut:function(){return this.zoomBy(-1)},setZoom:function(a){return this.zoomBy(a-this.coordinate.zoom)},zoomByAbout:function(a,b){var c=this.pointLocation(b);this.coordinate=this.enforceLimits(this.coordinate.zoomBy(a));var d=this.locationPoint(c);return this.dispatchCallback("zoomed",a),this.panBy(b.x-d.x,b.y-d.y)},panBy:function(b,c){return this.coordinate.column-=b/this.tileSize.x,this.coordinate.row-=c/this.tileSize.y,this.coordinate=this.enforceLimits(this.coordinate),a.getFrame(this.getRedraw()),this.dispatchCallback("panned",[b,c]),this},panLeft:function(){return this.panBy(100,0)},panRight:function(){return this.panBy(-100,0)},panDown:function(){return this.panBy(0,-100)},panUp:function(){return this.panBy(0,100)},setCenter:function(a){return this.setCenterZoom(a,this.coordinate.zoom)},setCenterZoom:function(b,c){return this.coordinate=this.projection.locationCoordinate(b).zoomTo(parseFloat(c)||0),a.getFrame(this.getRedraw()),this.dispatchCallback("centered",[b,c]),this},extentCoordinate:function(b,c){b instanceof a.Extent&&(b=b.toArray());var d,f;for(var g=0;g<b.length;g++){var h=this.projection.locationCoordinate(b[g]);d?(d.row=Math.min(d.row,h.row),d.column=Math.min(d.column,h.column),d.zoom=Math.min(d.zoom,h.zoom),f.row=Math.max(f.row,h.row),f.column=Math.max(f.column,h.column),f.zoom=Math.max(f.zoom,h.zoom)):(d=h.copy(),f=h.copy())}var i=this.dimensions.x+1,j=this.dimensions.y+1,k=(f.column-d.column)/(i/this.tileSize.x),l=Math.log(k)/Math.log(2),m=d.zoom-(c?l:Math.ceil(l)),n=(f.row-d.row)/(j/this.tileSize.y),o=Math.log(n)/Math.log(2),p=d.zoom-(c?o:Math.ceil(o)),q=Math.min(m,p);q=Math.min(q,this.coordLimits[1].zoom),q=Math.max(q,this.coordLimits[0].zoom);var r=(d.row+f.row)/2,s=(d.column+f.column)/2,t=d.zoom;return(new a.Coordinate(r,s,t)).zoomTo(q)},setExtent:function(a,b){return this.coordinate=this.extentCoordinate(a,b),this.draw(),this.dispatchCallback("extentset",a),this},setSize:function(b){return this.dimensions=new a.Point(b.x,b.y),this.parent.style.width=Math.round(this.dimensions.x)+"px",this.parent.style.height=Math.round(this.dimensions.y)+"px",this.autoSize&&(a.removeEvent(window,"resize",this.windowResize()),this.autoSize=!1),this.draw(),this.dispatchCallback("resized",this.dimensions),this},coordinatePoint:function(b){b.zoom!=this.coordinate.zoom&&(b=b.zoomTo(this.coordinate.zoom));var c=new a.Point(this.dimensions.x/2,this.dimensions.y/2);return c.x+=this.tileSize.x*(b.column-this.coordinate.column),c.y+=this.tileSize.y*(b.row-this.coordinate.row),c},pointCoordinate:function(a){var b=this.coordinate.copy();return b.column+=(a.x-this.dimensions.x/2)/this.tileSize.x,b.row+=(a.y-this.dimensions.y/2)/this.tileSize.y,b},locationCoordinate:function(a){return this.projection.locationCoordinate(a)},coordinateLocation:function(a){return this.projection.coordinateLocation(a)},locationPoint:function(a){return this.coordinatePoint(this.locationCoordinate(a))},pointLocation:function(a){return this.coordinateLocation(this.pointCoordinate(a))},getExtent:function(){return new a.Extent(this.pointLocation(new a.Point(0,0)),this.pointLocation(this.dimensions))},extent:function(a,b){return a?this.setExtent(a,b):this.getExtent()},getCenter:function(){return this.projection.coordinateLocation(this.coordinate)},center:function(a){return a?this.setCenter(a):this.getCenter()},getZoom:function(){return this.coordinate.zoom},zoom:function(a){return a!==undefined?this.setZoom(a):this.getZoom()},getLayers:function(){return this.layers.slice()},getLayer:function(a){for(var b=0;b<this.layers.length;b++)if(a==this.layers[b].name)return this.layers[b]},getLayerAt:function(a){return this.layers[a]},addLayer:function(b){return this.layers.push(b),this.parent.appendChild(b.parent),b.map=this,this.coordinate&&a.getFrame(this.getRedraw()),this},removeLayer:function(a){for(var b=0;b<this.layers.length;b++)if(a==this.layers[b]||a==this.layers[b].name){this.removeLayerAt(b);break}return this},setLayerAt:function(b,c){if(b<0||b>=this.layers.length)throw new Error("invalid index in setLayerAt(): "+b);if(this.layers[b]!=c){if(b<this.layers.length){var d=this.layers[b];this.parent.insertBefore(c.parent,d.parent),d.destroy()}else this.parent.appendChild(c.parent);this.layers[b]=c,c.map=this,a.getFrame(this.getRedraw())}return this},insertLayerAt:function(b,c){if(b<0||b>this.layers.length)throw new Error("invalid index in insertLayerAt(): "+b);if(b==this.layers.length)this.layers.push(c),this.parent.appendChild(c.parent);else{var d=this.layers[b];this.parent.insertBefore(c.parent,d.parent),this.layers.splice(b,0,c)}return c.map=this,a.getFrame(this.getRedraw()),this},removeLayerAt:function(a){if(a<0||a>=this.layers.length)throw new Error("invalid index in removeLayer(): "+a);var b=this.layers[a];return this.layers.splice(a,1),b.destroy(),this},swapLayersAt:function(a,b){if(a<0||a>=this.layers.length||b<0||b>=this.layers.length)throw new Error("invalid index in swapLayersAt(): "+index);var c=this.layers[a],d=this.layers[b],e=document.createElement("div");return this.parent.replaceChild(e,d.parent),this.parent.replaceChild(d.parent,c.parent),this.parent.replaceChild(c.parent,e),this.layers[a]=d,this.layers[b]=c,this},enableLayer:function(a){var b=this.getLayer(a);return b&&b.enable(),this},enableLayerAt:function(a){var b=this.getLayerAt(a);return b&&b.enable(),this},disableLayer:function(a){var b=this.getLayer(a);return b&&b.disable(),this},disableLayerAt:function(a){var b=this.getLayerAt(a);return b&&b.disable(),this},enforceZoomLimits:function(a){var b=this.coordLimits;if(b){var c=b[0].zoom,d=b[1].zoom;a.zoom<c?a=a.zoomTo(c):a.zoom>d&&(a=a.zoomTo(d))}return a},enforcePanLimits:function(b){if(this.coordLimits){b=b.copy();var c=this.coordLimits[0].zoomTo(b.zoom),d=this.coordLimits[1].zoomTo(b.zoom),f=this.pointCoordinate(new a.Point(0,0)).zoomTo(b.zoom),g=this.pointCoordinate(this.dimensions).zoomTo(b.zoom);d.row-c.row<g.row-f.row?b.row=(d.row+c.row)/2:f.row<c.row?b.row+=c.row-f.row:g.row>d.row&&(b.row-=g.row-d.row),d.column-c.column<g.column-f.column?b.column=(d.column+c.column)/2:f.column<c.column?b.column+=c.column-f.column:g.column>d.column&&(b.column-=g.column-d.column)}return b},enforceLimits:function(a){return this.enforcePanLimits(this.enforceZoomLimits(a))},draw:function(){this.coordinate=this.enforceLimits(this.coordinate);if(this.dimensions.x<=0||this.dimensions.y<=0){if(!this.autoSize)return;var b=this.parent.offsetWidth,c=this.parent.offsetHeight;this.dimensions=new a.Point(b,c);if(b<=0||c<=0)return}for(var d=0;d<this.layers.length;d++)this.layers[d].draw();this.dispatchCallback("drawn")},_redrawTimer:undefined,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var a=this;this._redraw=function(){a.draw(),a._redrawTimer=0}}return this._redraw},destroy:function(){for(var b=0;b<this.layers.length;b++)this.layers[b].destroy();this.layers=[],this.projection=null;for(var c=0;c<this.eventHandlers.length;c++)this.eventHandlers[c].remove();this.autoSize&&a.removeEvent(window,"resize",this.windowResize())}},a.mapByCenterZoom=function(b,c,d,f){var g=a.coerceLayer(c),h=new a.Map(b,g,!1);return h.setCenterZoom(d,f).draw(),h},a.mapByExtent=function(b,c,d,f){var g=a.coerceLayer(c),h=new a.Map(b,g,!1);return h.setExtent([d,f]).draw(),h},typeof module!="undefined"&&module.exports&&(module.exports={Point:a.Point,Projection:a.Projection,MercatorProjection:a.MercatorProjection,LinearProjection:a.LinearProjection,Transformation:a.Transformation,Location:a.Location,MapProvider:a.MapProvider,Template:a.Template,Coordinate:a.Coordinate,deriveTransformation:a.deriveTransformation})})(MM);var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};var html=function(a){function j(b,c,d){var e=[];return i(function(b,e){for(var f=0;f<e.length;f+=2){var g=e[f],h=e[f+1],i=null,j;if((j=b+"::"+g,a.ATTRIBS.hasOwnProperty(j))||(j="*::"+g,a.ATTRIBS.hasOwnProperty(j)))i=a.ATTRIBS[j];if(i!==null)switch(i){case a.atype.NONE:break;case a.atype.SCRIPT:case a.atype.STYLE:h=null;break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:h=d?d(h):h;break;case a.atype.URI:var k=(""+h).match(z);k?!k[1]||m.test(k[1])?h=c&&c(h):h=null:h=null;break;case a.atype.URI_FRAGMENT:h&&"#"===h.charAt(0)?(h=d?d(h):h,h&&(h="#"+h)):h=null;break;default:h=null}else h=null;e[f+1]=h}return e})(b,e),e.join("")}function i(b){var c,d;return h({startDoc:function(a){c=[],d=!1},startTag:function(e,g,h){if(!d){if(!a.ELEMENTS.hasOwnProperty(e))return;var i=a.ELEMENTS[e];if(i&a.eflags.FOLDABLE)return;if(i&a.eflags.UNSAFE){d=!(i&a.eflags.EMPTY);return}g=b(e,g);if(g){i&a.eflags.EMPTY||c.push(e),h.push("<",e);for(var j=0,k=g.length;j<k;j+=2){var l=g[j],m=g[j+1];m!==null&&m!==void 0&&h.push(" ",l,'="',f(m),'"')}h.push(">")}}},endTag:function(b,e){if(d)d=!1;else{if(!a.ELEMENTS.hasOwnProperty(b))return;var f=a.ELEMENTS[b];if(!(f&(a.eflags.UNSAFE|a.eflags.EMPTY|a.eflags.FOLDABLE))){var g;if(f&a.eflags.OPTIONAL_ENDTAG)for(g=c.length;--g>=0;){var h=c[g];if(h===b)break;if(!(a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG))return}else for(g=c.length;--g>=0;)if(c[g]===b)break;if(g<0)return;for(var i=c.length;--i>g;){var h=c[i];a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG||e.push("</",h,">")}c.length=g,e.push("</",b,">")}}},pcdata:function(a,b){d||b.push(a)},rcdata:function(a,b){d||b.push(a)},cdata:function(a,b){d||b.push(a)},endDoc:function(a){for(var b=c.length;--b>=0;)a.push("</",c[b],">");c.length=0}})}function h(b){return function(c,f){c=String(c);var h=null,i=!1,j=[],l=void 0,m=void 0,n=void 0;b.startDoc&&b.startDoc(f);while(c){var o=c.match(i?x:y);c=c.substring(o[0].length);if(i){if(o[1]){var p=k(o[1]),q;if(o[2]){var r=o[3];switch(r.charCodeAt(0)){case 34:case 39:r=r.substring(1,r.length-1)}q=e(d(r))}else q=p;j.push(p,q)}else if(o[4]){m!==void 0&&(n?b.startTag&&b.startTag(l,j,f):b.endTag&&b.endTag(l,f));if(n&&m&(a.eflags.CDATA|a.eflags.RCDATA)){h===null?h=k(c):h=h.substring(h.length-c.length);var s=h.indexOf("</"+l);s<0&&(s=c.length),s&&(m&a.eflags.CDATA?b.cdata&&b.cdata(c.substring(0,s),f):b.rcdata&&b.rcdata(g(c.substring(0,s)),f),c=c.substring(s))}l=m=n=void 0,j.length=0,i=!1}}else if(o[1])b.pcdata&&b.pcdata(o[0],f);else if(o[3])n=!o[2],i=!0,l=k(o[3]),m=a.ELEMENTS.hasOwnProperty(l)?a.ELEMENTS[l]:void 0;else if(o[4])b.pcdata&&b.pcdata(o[4],f);else if(o[5]&&b.pcdata){var t=o[5];b.pcdata(t==="<"?"&lt;":t===">"?"&gt;":"&amp;",f)}}b.endDoc&&b.endDoc(f)}}function g(a){return a.replace(s,"&amp;$1").replace(t,"&lt;").replace(u,"&gt;")}function f(a){return a.replace(r,"&amp;").replace(t,"&lt;").replace(u,"&gt;").replace(v,"&#34;").replace(w,"&#61;")}function e(a){return a.replace(q,c)}function d(a){return a.replace(p,"")}function c(a,c){return b(c)}function b(a){a=k(a);if(l.hasOwnProperty(a))return l[a];var b=a.match(n);return b?String.fromCharCode(parseInt(b[1],10)):(b=a.match(o))?String.fromCharCode(parseInt(b[1],16)):""}var k;"script"==="SCRIPT".toLowerCase()?k=function(a){return a.toLowerCase()}:k=function(a){return a.replace(/[A-Z]/g,function(a){return String.fromCharCode(a.charCodeAt(0)|32)})};var l={lt:"<",gt:">",amp:"&",nbsp:" ",quot:'"',apos:"'"},m=/^(?:https?|mailto|data)$/i,n=/^#(\d+)$/,o=/^#x([0-9A-Fa-f]+)$/,p=/\0/g,q=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,r=/&/g,s=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,t=/</g,u=/>/g,v=/\"/g,w=/\=/g,x=new RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[\\s\\S][^a-z\\s>]*)","i"),y=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i"),z=new RegExp("^(?:([^:/?#]+):)?");return{escapeAttrib:f,makeHtmlSanitizer:i,makeSaxParser:h,normalizeRCData:g,sanitize:j,unescapeEntities:e}}(html4),html_sanitize=html.sanitize;typeof window!="undefined"&&(window.html=html,window.html_sanitize=html_sanitize),html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0,wax=wax||{},wax.attribution=function(){var a={},b=document.createElement("div");return b.className="map-attribution",a.content=function(a){return typeof a=="undefined"?b.innerHTML:(b.innerHTML=wax.u.sanitize(a),this)},a.element=function(){return b},a.init=function(){return this},a},wax=wax||{},wax.bwdetect=function(a,b){function c(){wax.bw=-1;var a=new Image;a.src=f;var b=!0,c=setTimeout(function(){b&&wax.bw==-1&&(d.bw(0),b=!1)},e);a.onload=function(){b&&wax.bw==-1&&(clearTimeout(c),d.bw(1),b=!1)}}var d={},e=a.threshold||400,f="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +(new Date),g=1,h=a.auto===undefined?!0:a.auto;return d.bw=function(a){if(!arguments.length)return g;var c=g;wax.bwlisteners&&wax.bwlisteners.length&&function(){listeners=wax.bwlisteners,wax.bwlisteners=[];for(i=0;i<listeners;i++)listeners[i](a)}(),wax.bw=a,g!=(g=a)&&b(a)},d.add=function(){return h&&c(),this},wax.bw==-1?(wax.bwlisteners=wax.bwlisteners||[],wax.bwlisteners.push(d.bw)):wax.bw!==undefined?d.bw(wax.bw):d.add(),d},wax.formatter=function(x){var formatter={},f;if(x&&typeof x=="string")try{eval("f = "+x)}catch(e){console&&console.log(e)}else x&&typeof x=="function"?f=x:f=function(){};return formatter.format=function(a,b){try{return wax.u.sanitize(f(a,b))}catch(c){console&&console.log(c)}},formatter},wax.gi=function(a,b){function c(a){return a>=93&&a--,a>=35&&a--,a-=32,a}b=b||{};var d={},e=b.resolution||4,f=b.tileSize||256;return d.grid_tile=function(){return a},d.getKey=function(b,d){if(!!a&&!!a.grid){if(d<0||b<0)return;if(Math.floor(d)>=f||Math.floor(b)>=f)return;return c(a.grid[Math.floor(d/e)].charCodeAt(Math.floor(b/e)))}},d.gridFeature=function(b,c){var d=this.getKey(b,c),e=a.keys;if(e&&e[d]&&a.data[e[d]])return a.data[e[d]]},d.tileFeature=function(b,c,d){if(!!a){var e=wax.u.offset(d);return feature=this.gridFeature(b-e.left,c-e.top),feature}},d},wax.gm=function(){function a(a){return typeof a=="string"&&(a=[a]),function(b){if(!!b){var c=new RegExp("/(\\d+)\\/(\\d+)\\/(\\d+)\\.[\\w\\._]+"),d=c.exec(b);if(!d)return;return a[parseInt(d[2],10)%a.length].replace(/\{z\}/g,d[1]).replace(/\{x\}/g,d[2]).replace(/\{y\}/g,d[3])}}}var b=4,c={},d={},e,f,g=function(a){if(a)return a.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json")};return d.formatter=function(a){return arguments.length?(f=wax.formatter(a),d):f},d.template=function(a){return arguments.length?(f=wax.template(a),d):f},d.gridUrl=function(b){return arguments.length?(b?g=typeof b=="function"?b:a(b):g=function(){return null},d):g},d.getGrid=function(a,c){var e=g(a);return!f||!e?c(null,null):(wax.request.get(e,function(a,d){if(a)return c(a,null);c(null,wax.gi(d,{formatter:f,resolution:b}))}),d)},d.tilejson=function(a){return arguments.length?(a.template?d.template(a.template):a.formatter?d.formatter(a.formatter):f=undefined,d.gridUrl(a.grids),a.resolution&&(b=a.resolution),e=a,d):e},d},wax=wax||{},wax.hash=function(a){function f(a){a!==g&&d(g=a)&&e()}function e(){var b=a.getCenterZoom();g!==b&&(g=b,c(g))}function d(b){var c=b.split("/");for(var d=0;d<c.length;d++){c[d]=Number(c[d]);if(isNaN(c[d]))return!0}if(c.length<3)return!0;c.length==3&&a.setCenterZoom(c)}function c(a){var b=window.location;b.replace(b.toString().replace(b.hash||/$/,"#"+a))}function b(){return location.hash.substring(1)}a=a||{};var g,h={},i=90-1e-8,j=wax.u.throttle(e,500);return h.add=function(){return f(b()),a.bindChange(j),h},h.remove=function(){return a.unbindChange(j),h},h},wax=wax||{},wax.interaction=function(){function g(a){var c={},d=wax.u.eventoffset(a);j=!1;for(var e in a)c[e]=a[e];return bean.remove(document.body,"mouseup",g),bean.remove(a.srcElement,u),a.type==="touchend"?i.click(a,l):Math.round(d.y/m)===Math.round(l.y/m)&&Math.round(d.x/m)===Math.round(l.x/m)&&(k?b():k=window.setTimeout(function(){k=null,i.click(c,d)},300)),g}function f(a){bean.remove(a.srcElement,u),j=!1}function e(a){j=!0,l=wax.u.eventoffset(a),a.type==="mousedown"?(bean.add(document.body,"click",g),bean.add(document.body,"mouseup",d)):a.type==="touchstart"&&a.touches.length===1&&(bean.fire(i,"off"),bean.add(a.srcElement,u))}function d(){j=!1}function c(a){if(!j){var b=wax.u.eventoffset(a);i.screen_feature(b,function(b){b?bean.fire(i,"on",{parent:q(),data:b,formatter:h.formatter().format,e:a}):bean.fire(i,"off")})}}function b(){return k?(window.clearTimeout(k),k=null,!0):!1}function a(a){var b=n();for(var c=0;c<b.length;c++)if(b[c][0]<a.y&&b[c][0]+256>a.y&&b[c][1]<a.x&&b[c][1]+256>a.x)return b[c][2];return!1}var h=wax.gm(),i={},j=!1,k=null,l,m=4,n,o,p,q,r,s,t={mousemove:c,touchstart:e,mousedown:e},u={touchend:g,touchmove:g,touchcancel:f};return i.click=function(a,b){i.screen_feature(b,function(b){b&&bean.fire(i,"on",{parent:q(),data:b,formatter:h.formatter().format,e:a})})},i.screen_feature=function(b,c){var d=a(b);d||c(null),h.getGrid(d.src,function(a,e){if(a||!e)return c(null);var f=e.tileFeature(b.x,b.y,d);c(f)})},i.attach=function(a){return arguments.length?(o=a,i):o},i.detach=function(a){return arguments.length?(p=a,i):p},i.map=function(a){return arguments.length?(r=a,o&&o(r),bean.add(q(),t),bean.add(q(),"touchstart",e),i):r},i.grid=function(a){return arguments.length?(n=a,i):n},i.remove=function(a){return p&&p(r),bean.remove(q(),t),bean.fire(i,"remove"),i},i.tilejson=function(a){return arguments.length?(h.tilejson(a),i):h.tilejson()},i.formatter=function(){return h.formatter()},i.on=function(a,b){return bean.add(i,a,b),i},i.off=function(a,b){return bean.remove(i,a,b),i},i.gridmanager=function(a){return arguments.length?(h=a,i):h},i.parent=function(a){return q=a,i},i};var wax=wax||{};wax.legend=function(){var a,b={},c;return b.element=function(){return c},b.content=function(c){return arguments.length?(a.innerHTML=wax.u.sanitize(c),a.style.display="block",a.innerHTML===""&&(a.style.display="none"),b):a.innerHTML},b.add=function(){return c=document.createElement("div"),c.className="map-legends wax-legends",a=c.appendChild(document.createElement("div")),a.className="map-legend wax-legend",a.style.display="none",b},b.add()};var wax=wax||{};wax.location=function(){function a(a){if(a.e.type!=="mousemove"&&!!a.e.type){var b=a.formatter({format:"location"},a.data);b&&(window.top.location.href=b)}}var b={};return b.events=function(){return{on:a}},b};var wax=wax||{};wax.movetip={},wax.movetip=function(){function e(){k.style.cursor="default",f||c()}function d(d){var e;if(!f){if(d.e.type==="mousemove"||!d.e.type){e=d.formatter({format:"teaser"},d.data);if(!e)return;c(),k.style.cursor="pointer",j=document.body.appendChild(b(e))}else{e=d.formatter({format:"teaser"},d.data);if(!e)return;c();var g=document.body.appendChild(b(e));g.className+=" map-popup";var l=g.appendChild(document.createElement("a"));l.href="#close",l.className="close",l.innerHTML="Close",f=!0,j=g,h=wax.u.offset(j),i=wax.u.offset(k),a(d.e),bean.add(l,"click touchend",function(a){a.stop(),c(),f=!1})}j&&(h=wax.u.offset(j),i=wax.u.offset(k),a(d.e))}}function c(){j&&(j.parentNode.removeChild(j),j=null)}function b(a){var b=document.createElement("div");return b.className="map-tooltip map-tooltip-0",b.innerHTML=a,b}function a(a){var b=wax.u.eventoffset(a);h.height+b.y>i.top+i.height&&i.height>h.height&&(b.y-=h.height,j.className+=" flip-y"),h.width+b.x>i.left+i.width&&(b.x-=h.width,j.className+=" flip-x"),j.style.left=b.x+"px",j.style.top=b.y+"px"}var f=!1,g={},h,i,j,k;return g.parent=function(a){return arguments.length?(k=a,g):k},g.events=function(){return{on:d,off:e}},g};var wax=wax||{};wax.request={cache:{},locks:{},promises:{},get:function(a,b){if(this.cache[a])return b(this.cache[a][0],this.cache[a][1]);this.promises[a]=this.promises[a]||[],this.promises[a].push(b);if(!this.locks[a]){var c=this;this.locks[a]=!0,reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=?",type:"jsonp",success:function(b){c.locks[a]=!1,c.cache[a]=[null,b];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])},error:function(b){c.locks[a]=!1,c.cache[a]=[b,null];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])}})}}},wax.template=function(a){var b={};return b.format=function(b,c){var d={};for(var f in c)d[f]=c[f];return b.format&&(d["__"+b.format+"__"]=!0),wax.u.sanitize(Mustache.to_html(a,d))},b};if(!wax)var wax={};wax.tilejson=function(a,b){reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=?",type:"jsonp",success:b,error:b})};var wax=wax||{};wax.tooltip={},wax.tooltip=function(){function e(){l.style.cursor="default",j=null,f||c()}function d(b){var d;if(b.e.type==="mousemove"||!b.e.type){if(!f){d=b.content||b.formatter({format:"teaser"},b.data);if(!d||d==j)return;c(),l.style.cursor="pointer",i.push(l.appendChild(a(d))),j=d}}else{d=b.content||b.formatter({format:"full"},b.data);if(!d){b.e.type&&b.e.type.match(/touch/)&&(d=b.content||b.formatter({format:"teaser"},b.data));if(!d)return}c(),l.style.cursor="pointer";var e=l.appendChild(a(d));e.className+=" map-popup wax-popup";var g=e.appendChild(document.createElement("a"));g.href="#close",g.className="close",g.innerHTML="Close",f=!0,i.push(e),bean.add(g,"touchstart mousedown",function(a){a.stop()}),bean.add(g,"click touchend",function(a){a.stop(),c(),f=!1})}}function c(){var a;while(a=i.pop())g&&k?(bean.add(a,k,b),a.className+=" map-fade"):a.parentNode&&a.parentNode.removeChild(a)}function b(){this.parentNode&&this.parentNode.removeChild(this)}function a(a){var b=document.createElement("div");return b.className="map-tooltip map-tooltip-0 wax-tooltip",b.innerHTML=a,b}var f=!1,g=!1,h={},i=[],j,k,l;return document.body.style["-webkit-transition"]!==undefined?k="webkitTransitionEnd":document.body.style.MozTransition!==undefined&&(k="transitionend"),h.parent=function(a){return arguments.length?(l=a,h):l},h.animate=function(a){return arguments.length?(g=a,h):g},h.events=function(){return{on:d,off:e}},h};var wax=wax||{};wax.u={offset:function(a){var b=a.offsetWidth||parseInt(a.style.width,10),c=a.offsetHeight||parseInt(a.style.height,10),d=document.body,e=0,f=0,g=function(a){if(a!==d&&a!==document.documentElement){e+=a.offsetTop,f+=a.offsetLeft;var b=a.style.transform||a.style.WebkitTransform||a.style.OTransform||a.style.MozTransform||a.style.msTransform;if(b){var c;if(c=b.match(/translate\((.+)[px]?, (.+)[px]?\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10);else if(c=b.match(/translate3d\((.+)[px]?, (.+)[px]?, (.+)[px]?\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10);else if(c=b.match(/matrix3d\(([\-\d,\s]+)\)/)){var g=c[1].split(",");e+=parseInt(g[13],10),f+=parseInt(g[12],10)}else if(c=b.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10)}}};if(typeof a.getBoundingClientRect!="undefined"){var h=document.body,i=a.ownerDocument.documentElement,j=document.clientTop||h.clientTop||0,k=document.clientLeft||h.clientLeft||0,l=window.pageYOffset||i.scrollTop,m=window.pageXOffset||i.scrollLeft,n=a.getBoundingClientRect();e=n.top+l-j,f=n.left+m-k}else{g(a);try{while(a=a.offsetParent)g(a)}catch(o){}}e+=d.offsetTop,f+=d.offsetLeft,e+=d.parentNode.offsetTop,f+=d.parentNode.offsetLeft;var p=document.defaultView?window.getComputedStyle(d.parentNode,null):d.parentNode.currentStyle;return d.parentNode.offsetTop!==parseInt(p.marginTop,10)&&!isNaN(parseInt(p.marginTop,10))&&(e+=parseInt(p.marginTop,10),f+=parseInt(p.marginLeft,10)),{top:e,left:f,height:c,width:b}},$:function(a){return typeof a=="string"?document.getElementById(a):a},eventoffset:function(a){var b=0,c=0;a||(a=window.event);if(a.pageX||a.pageY)return{x:a.pageX,y:a.pageY};if(a.clientX||a.clientY)return{x:a.clientX,y:a.clientY};if(a.touches&&a.touches.length===1)return{x:a.touches[0].pageX,y:a.touches[0].pageY}},limit:function(a,b,c){var d;return function(){var f=this,g=arguments,h=function(){d=null,a.apply(f,g)};c&&clearTimeout(d);if(c||!d)d=setTimeout(h,b)}},throttle:function(a,b){return this.limit(a,b,!1)},sanitize:function(a){function c(a){return a}function b(a){if(/^(https?:\/\/|data:image)/.test(a))return a}return a?html_sanitize(a,b,c):""}},wax=wax||{},wax.mm=wax.mm||{},wax.mm.attribution=function(){var a,b={},c=document.createElement("div");return c.className="map-attribution map-mm",b.content=function(a){return typeof a=="undefined"?c.innerHTML:(c.innerHTML=wax.u.sanitize(a),b)},b.element=function(){return c},b.map=function(c){return arguments.length?(a=c,b):a},b.add=function(){return a?(a.parent.appendChild(c),b):!1},b.remove=function(){return a?(c.parentNode&&c.parentNode.removeChild(c),b):!1},b.appendTo=function(a){return wax.u.$(a).appendChild(c),b},b},wax=wax||{},wax.mm=wax.mm||{},wax.mm.boxselector=function(){function h(a,b){if(!!k&&!!s){var c=a.locationPoint(s[1]),d=a.locationPoint(s[0]),e=k.style;e.display="block",e.height="auto",e.width="auto",e.left=Math.max(0,d.x)+"px",e.top=Math.max(0,d.y)+"px",e.right=Math.max(0,a.dimensions.x-c.x)+"px",e.bottom=Math.max(0,a.dimensions.y-c.y)+"px"}}function g(a,b){var c={x:parseInt(k.offsetLeft,10),y:parseInt(k.offsetTop,10)},d={x:c.x+parseInt(k.offsetWidth,10),y:c.y+parseInt(k.offsetHeight,10)},e="";a.y-c.y<=p?e="n":d.y-a.y<=p&&(e="s"),a.x-c.x<=p?e+="w":d.x-a.x<=p&&(e+="e"),e!==""&&(e+="-resize"),b.style.cursor=e}function f(b){g(a(b),k)}function e(b){var c=a(b),f=u.pointLocation(new MM.Point(n?c.x:j.x,o?c.y:j.y));l2=u.pointLocation(i),t.extent([new MM.Location(Math.max(f.lat,l2.lat),Math.min(f.lon,l2.lon)),new MM.Location(Math.min(f.lat,l2.lat),Math.max(f.lon,l2.lon))]),r(document,"mousemove",d),r(document,"mouseup",e),u.parent.style.cursor="auto"}function d(b){var c=a(b);return l.display="block",n&&(l.left=(c.x<i.x?c.x:i.x)+"px",l.width=Math.abs(c.x-i.x)-2*m+"px"),o&&(l.top=(c.y<i.y?c.y:i.y)+"px",l.height=Math.abs(c.y-i.y)-2*m+"px"),g(c,u.parent),MM.cancelEvent(b)}function c(b){var c=a(b),f={x:parseInt(k.offsetLeft,10),y:parseInt(k.offsetTop,10)},g={x:f.x+parseInt(k.offsetWidth,10),y:f.y+parseInt(k.offsetHeight,10)};n=c.x-f.x<=p||g.x-c.x<=p,o=c.y-f.y<=p||g.y-c.y<=p;if(o||n)return i={x:c.x-f.x<g.x-c.x?g.x:f.x,y:c.y-f.y<g.y-c.y?g.y:f.y},j={x:c.x-f.x<g.x-c.x?f.x:g.x,y:c.y-f.y<g.y-c.y?f.y:g.y},q(document,"mousemove",d),q(document,"mouseup",e),MM.cancelEvent(b)}function b(b){if(!!b.shiftKey)return i=j=a(b),n=o=!0,l.left=i.x+"px",l.top=i.y+"px",l.width=l.height=0,q(document,"mousemove",d),q(document,"mouseup",e),u.parent.style.cursor="crosshair",MM.cancelEvent(b)}function a(a){var b=new MM.Point(a.clientX,a.clientY);b.x+=document.body.scrollLeft+document.documentElement.scrollLeft,b.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var c=u.parent;c;c=c.offsetParent)b.x-=c.offsetLeft,b.y-=c.offsetTop;return b}var i,j,k,l,m=0,n=!1,o=!1,p=5,q=MM.addEvent,r=MM.removeEvent,s,t={},u,v=new MM.CallbackManager(t,["change"]);return t.addCallback=function(a,b){return v.addCallback(a,b),t},t.removeCallback=function(a,b){return v.removeCallback(a,b),t},t.extent=function(a,b){if(!a)return s;s=[new MM.Location(Math.max(a[0].lat,a[1].lat),Math.min(a[0].lon,a[1].lon)),new MM.Location(Math.min(a[0].lat,a[1].lat),Math.max(a[0].lon,a[1].lon))],h(u),b||v.dispatchCallback("change",s)},k=document.createElement("div"),k.className="boxselector-box",l=k.style,t.add=function(){return k.id=u.parent.id+"-boxselector-box",u.parent.appendChild(k),m=parseInt(window.getComputedStyle(k).borderWidth,10),q(u.parent,"mousedown",b),q(k,"mousedown",c),q(u.parent,"mousemove",f),u.addCallback("drawn",h),t},t.map=function(a){return arguments.length?(u=a,t):u},t.remove=function(){return u.parent.removeChild(k),r(u.parent,"mousedown",b),r(k,"mousedown",c),r(u.parent,"mousemove",f),u.removeCallback("drawn",h),t},t},wax=wax||{},wax.mm=wax.mm||{},wax._={},wax.mm.bwdetect=function(a,b){b=b||{};var c=b.png||".png128",d=b.jpg||".jpg70",e=!1;return wax._.bw_png=c,wax._.bw_jpg=d,wax.bwdetect(b,function(b){wax._.bw=!b;for(var c=0;c<a.layers.length;c++)a.getLayerAt(c).provider instanceof wax.mm.connector&&a.getLayerAt(c).setProvider(a.getLayerAt(c).provider)})},wax=wax||{},wax.mm=wax.mm||{},wax.mm.fullscreen=function(){function a(a){a&&a.stop(),b?c.original():c.full()}var b=!1,c={},d=document.createElement("a"),e,f=document.body,g;return d.className="map-fullscreen",d.href="#fullscreen",c.map=function(a){return arguments.length?(e=a,c):e},c.add=function(){return bean.add(d,"click",a),e.parent.appendChild(d),c},c.remove=function(){return bean.remove(d,"click",a),d.parentNode&&d.parentNode.removeChild(d),c},c.full=function(){if(!b)return b=!0,g=e.dimensions,e.parent.className+=" map-fullscreen-map",f.className+=" map-fullscreen-view",e.dimensions={x:e.parent.offsetWidth,y:e.parent.offsetHeight},e.draw(),c},c.original=function(){if(!!b)return b=!1,e.parent.className=e.parent.className.replace(" map-fullscreen-map",""),f.className=f.className.replace(" map-fullscreen-view",""),e.dimensions=g,e.draw(),c},c.fullscreen=function(a){return arguments.length?(a&&!b?c.full():!a&&b&&c.original(),c):b},c.element=function(){return d},c.appendTo=function(a){return wax.u.$(a).appendChild(d),c},c},wax=wax||{},wax.mm=wax.mm||{},wax.mm.hash=function(){var a,b=wax.hash({getCenterZoom:function(){var b=a.getCenter(),c=a.getZoom(),d=Math.max(0,Math.ceil(Math.log(c)/Math.LN2));return[c.toFixed(2),b.lat.toFixed(d),b.lon.toFixed(d)].join("/")},setCenterZoom:function(b){a.setCenterZoom(new MM.Location(b[1],b[2]),b[0])},bindChange:function(b){a.addCallback("drawn",b)},unbindChange:function(b){a.removeCallback("drawn",b)}});return b.map=function(c){return arguments.length?(a=c,b):a},b},wax=wax||{},wax.mm=wax.mm||{},wax.mm.interaction=function(){function d(a){for(var c=0;c<h.length;c++)g.removeCallback(h[c],b)}function c(a){if(!arguments.length)return g;g=a;for(var c=0;c<h.length;c++)g.addCallback(h[c],b)}function b(){e=!0}function a(){if(!e&&f!==undefined&&f.length)return f;var a;for(var b=0;b<g.getLayers().length;b++){var c=g.getLayerAt(b).levels,d=c&&c[Math.round(g.zoom())];if(d!==undefined){a=g.getLayerAt(b).tileElementsInLevel(d);if(a.length)break}}return f=function(a){var b=[];for(var c in a)if(a[c].parentNode===d){var e=wax.u.offset(a[c]);b.push([e.top,e.left,a[c]])}return b}(a),f}var e=!1,f,g,h=["zoomed","panned","centered","extentset","resized","drawn"];return wax.interaction().attach(c).detach(d).parent(function(){return g.parent}).grid(a)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.legend=function(){var a,b={},c=document.createElement("div");c.className="wax-legends map-legends";var d=c.appendChild(document.createElement("div"));return d.className="wax-legend map-legend",d.style.display="none",b.content=function(a){return arguments.length?(d.innerHTML=wax.u.sanitize(a),d.style.display="block",d.innerHTML===""&&(d.style.display="none"),b):d.innerHTML},b.element=function(){return c},b.map=function(c){return arguments.length?(a=c,b):a},b.add=function(){return a?(b.appendTo(a.parent),b):!1},b.remove=function(){return c.parentNode&&c.parentNode.removeChild(c),b},b.appendTo=function(a){return wax.u.$(a).appendChild(c),b},b},wax=wax||{},wax.mm=wax.mm||{},wax.mm.pointselector=function(){function e(c){!g||(h=a(c),MM.Point.distance(g,h)<j&&(l.addLocation(f.pointLocation(g)),m.dispatchCallback("change",b(n))),g=null)}function d(b){g=a(b),bean.add(f.parent,"mouseup",e)}function c(){var a=new MM.Point(0,0);for(var b=0;b<n.length;b++){var c=f.locationPoint(n[b]);n[b].pointDiv||(n[b].pointDiv=document.createElement("div"),n[b].pointDiv.className="map-point-div",n[b].pointDiv.style.position="absolute",n[b].pointDiv.style.display="block",n[b].pointDiv.location=n[b],bean.add(n[b].pointDiv,"mouseup",function(a){var c=n[b];return function(a){MM.removeEvent(f.parent,"mouseup",e),l.deleteLocation(c,a)}}()),f.parent.appendChild(n[b].pointDiv)),n[b].pointDiv.style.left=c.x+"px",n[b].pointDiv.style.top=c.y+"px"}}function b(a){var b=[];for(var c=0;c<a.length;c++)b.push(new MM.Location(a[c].lat,a[c].lon));return b}function a(a){var b=wax.u.eventoffset(a),c=new MM.Point(b.x,b.y),d={x:parseFloat(MM.getStyle(document.documentElement,"margin-left")),y:parseFloat(MM.getStyle(document.documentElement,"margin-top"))};isNaN(d.x)||(c.x-=d.x),isNaN(d.y)||(c.y-=d.y);for(var e=f.parent;e;e=e.offsetParent)c.x-=e.offsetLeft,c.y-=e.offsetTop;return c}var f,g=null,h=null,i=null,j=5,k,l={},m=new MM.CallbackManager(l,["change"]),n=[];return l.addLocation=function(a){return n.push(a),c(),m.dispatchCallback("change",b(n)),l},l.locations=function(){if(!arguments.length)return n},l.addCallback=function(a,b){return m.addCallback(a,b),l},l.removeCallback=function(a,b){return m.removeCallback(a,b),l},l.map=function(a){return arguments.length?(f=a,l):f},l.add=function(){return bean.add(f.parent,"mousedown",d),f.addCallback("drawn",c),l},l.remove=function(){bean.remove(f.parent,"mousedown",d),f.removeCallback("drawn",c);for(var a=n.length-1;a>-1;a--)l.deleteLocation(n[a]);return l},l.deleteLocation=function(a,c){if(!c||confirm("Delete this point?")){a.pointDiv.parentNode.removeChild(a.pointDiv);for(var d=0;d<n.length;d++)if(n[d]===a){n.splice(d,1);break}m.dispatchCallback("change",b(n))}},l},wax=wax||{},wax.mm=wax.mm||{},wax.mm.zoombox=function(){function d(b){if(!!g){var c=a(b);return h.style.display="block",c.x<i.x?h.style.left=c.x+"px":h.style.left=i.x+"px",h.style.width=Math.abs(c.x-i.x)+"px",c.y<i.y?h.style.top=c.y+"px":h.style.top=i.y+"px",h.style.height=Math.abs(c.y-i.y)+"px",MM.cancelEvent(b)}}function c(c){if(!!c.shiftKey&&!this.drawing)return g=!0,i=a(c),h.style.left=i.x+"px",h.style.top=i.y+"px",MM.addEvent(f.parent,"mousemove",d),MM.addEvent(f.parent,"mouseup",b),f.parent.style.cursor="crosshair",MM.cancelEvent(c)}function b(c){if(!!g){g=!1;var e=a(c),j=f.pointLocation(e),k=f.pointLocation(i);f.setExtent([j,k]),h.style.display="none",MM.removeEvent(f.parent,"mousemove",d),MM.removeEvent(f.parent,"mouseup",b),f.parent.style.cursor="auto"}}function a(a){var b=new MM.Point(a.clientX,a.clientY);b.x+=document.body.scrollLeft+document.documentElement.scrollLeft,b.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var c=f.parent;c;c=c.offsetParent)b.x-=c.offsetLeft,b.y-=c.offsetTop;return b}var e={},f,g=!1,h=document.createElement("div"),i=null;return e.map=function(a){return arguments.length?(f=a,e):f},e.add=function(){return f?(h.id=f.parent.id+"-zoombox-box",h.className="zoombox-box",f.parent.appendChild(h),MM.addEvent(f.parent,"mousedown",c),this):!1},e.remove=function(){return f?(h.parentNode&&h.parentNode.removeChild(h),MM.removeEvent(f.parent,"mousedown",c),e):!1},e},wax=wax||{},wax.mm=wax.mm||{},wax.mm.zoomer=function(){function d(a,b){a.coordinate.zoom===a.coordLimits[0].zoom?i.className="zoomer zoomout zoomdisabled":a.coordinate.zoom===a.coordLimits[1].zoom?h.className="zoomer zoomin zoomdisabled":(h.className="zoomer zoomin",i.className="zoomer zoomout")}function c(a){a.stop(),f&&g.ease?g.ease.zoom(g.zoom()-1).run(50):g.zoomOut()}function b(a){a.stop(),f&&g.ease?g.ease.zoom(g.zoom()+1).run(50):g.zoomIn()}function a(a){a.stop()}var e={},f=!0,g,h=document.createElement("a"),i=document.createElement("a");return h.innerHTML="+",h.href="#",h.className="zoomer zoomin",i.innerHTML="-",i.href="#",i.className="zoomer zoomout",e.map=function(a){return arguments.length?(g=a,e):g},e.add=function(){return g?(g.addCallback("drawn",d),e.appendTo(g.parent),bean.add(h,"mousedown dblclick",a),bean.add(i,"mousedown dblclick",a),bean.add(i,"touchstart click",c),bean.add(h,"touchstart click",b),e):!1},e.remove=function(){return g?(g.removeCallback("drawn",d),h.parentNode&&h.parentNode.removeChild(h),i.parentNode&&i.parentNode.removeChild(i),bean.remove(h,"mousedown dblclick",a),bean.remove(i,"mousedown dblclick",a),bean.remove(i,"touchstart click",c),bean.remove(h,"touchstart click",b),e):!1},e.appendTo=function(a){return wax.u.$(a).appendChild(h),wax.u.$(a).appendChild(i),e},e.smooth=function(a){return arguments.length?(f=a,e):f},e};var wax=wax||{};wax.mm=wax.mm||{},wax.mm._provider=function(a){this.options={tiles:a.tiles,scheme:a.scheme||"xyz",minzoom:a.minzoom||0,maxzoom:a.maxzoom||22,bounds:a.bounds||[-180,-90,180,90]}},wax.mm._provider.prototype={outerLimits:function(){return[this.locationCoordinate(new MM.Location(this.options.bounds[0],this.options.bounds[1])).zoomTo(this.options.minzoom),this.locationCoordinate(new MM.Location(this.options.bounds[2],this.options.bounds[3])).zoomTo(this.options.maxzoom)]},getTile:function(a){var b;if(!(b=this.sourceCoordinate(a)))return null;if(b.zoom<this.options.minzoom||b.zoom>this.options.maxzoom)return null;b.row=this.options.scheme==="tms"?Math.pow(2,b.zoom)-b.row-1:b.row;var c=this.options.tiles[parseInt(Math.pow(2,b.zoom)*b.row+b.column,10)%this.options.tiles.length].replace("{z}",b.zoom.toFixed(0)).replace("{x}",b.column.toFixed(0)).replace("{y}",b.row.toFixed(0));return wax._&&wax._.bw&&(c=c.replace(".png",wax._.bw_png).replace(".jpg",wax._.bw_jpg)),c}},MM&&MM.extend(wax.mm._provider,MM.MapProvider),wax.mm.connector=function(a){var b=new wax.mm._provider(a);return new MM.Layer(b)},function(a,b){var c=function(){function a(a,b,c){return c===0?a:c===1?b:a+(b-a)*c}var c={},d=!1,e=!1,f,g={easeIn:function(a){return a*a},easeOut:function(a){return Math.sin(a*Math.PI/2)},easeInOut:function(a){return(1-Math.cos(Math.PI*a))/2},linear:function(a){return a}},h=g.easeOut,i,j,k;c.stop=function(a){e=!0,i=undefined,f=a},c.running=function(){return d},c.point=function(a){return j=k.pointCoordinate(a),c},c.zoom=function(a){return j||(j=k.coordinate.copy()),j=k.enforceZoomLimits(j.zoomTo(a)),c},c.location=function(a){return j=k.locationCoordinate(a),c},c.from=function(a){return arguments.length?(i=a.copy(),c):i?i.copy():i},c.to=function(a){return arguments.length?(j=k.enforceZoomLimits(a.copy()),c):j.copy()},c.path=function(a){return n=l[a],c},c.easing=function(a){return h=g[a],c},c.map=function(a){return arguments.length?(k=a,c):k};var l={},m=new b.Coordinate(0,0,0);l.screen=function(c,d,e,f){var g=a(c.zoom,d.zoom,e);if(!f)return new b.Coordinate(a(c.row,d.row*Math.pow(2,c.zoom-d.zoom),e)*Math.pow(2,g-c.zoom),a(c.column,d.column*Math.pow(2,c.zoom-d.zoom),e)*Math.pow(2,g-c.zoom),g);f.row=a(c.row,d.row*Math.pow(2,c.zoom-d.zoom),e)*Math.pow(2,g-c.zoom),f.column=a(c.column,d.column*Math.pow(2,c.zoom-d.zoom),e)*Math.pow(2,g-c.zoom),f.zoom=g},l.about=function(c,d,e,f){var g=a(c.zoom,d.zoom,e),h=k.dimensions.x/2,i=k.dimensions.y/2,j=k.tileSize.x,l=k.tileSize.y,m=h+j*(d.column*Math.pow(2,c.zoom-d.zoom)-c.column),n=i+l*(d.row*Math.pow(2,c.zoom-d.zoom)-c.row),o=h+j*(d.column*Math.pow(2,g-d.zoom)-c.column*Math.pow(2,g-c.zoom)),p=i+l*(d.row*Math.pow(2,g-d.zoom)-c.row*Math.pow(2,g-c.zoom));if(!f)return new b.Coordinate(c.column*Math.pow(2,g-c.zoom)-(m-o)/j,c.row*Math.pow(2,g-c.zoom)-(n-p)/l,g);f.column=c.column*Math.pow(2,g-c.zoom)-(m-o)/j,f.row=c.row*Math.pow(2,g-c.zoom)-(n-p)/l,f.zoom=g};var n=l.screen;c.t=function(a){return n(i,j,h(a),m),k.coordinate=m,k.draw(),c},c.future=function(a){var b=[];for(var c=0;c<a;c++)b.push(n(i,j,c/(a-1)));return b};var o;return c.resetRun=function(){return o=+(new Date),c},c.run=function(a,g){function l(){var c=+(new Date)-o;if(e)return e=d=!1,f(),f=undefined;if(c>a){j.zoom!=i.zoom&&k.dispatchCallback("zoomed",j.zoom-i.zoom),d=!1,n(i,j,1,m),k.coordinate=m,j=i=undefined,k.draw();if(g)return g(k)}else n(i,j,h(c/a),m),k.coordinate=m,k.draw(),b.getFrame(l)}if(d)return c.stop(function(){c.run(a,g)});i||(i=k.coordinate.copy()),j||(j=k.coordinate.copy()),a=a||1e3,o=+(new Date),d=!0,b.getFrame(l)},c.optimal=function(e,f,g){function r(a){return Math.log(-q(a)+Math.sqrt(h(q(a))+1))}function q(a){var b=h(x)-h(w)+(a?-1:1)*Math.pow(f,4)*h(D-C),c=2*(a?x:w)*h(f)*(D-C);return b/c}function o(a){return l(a)/m(a)}function m(a){return(Math.exp(a)+Math.exp(-a))/2}function l(a){return(Math.exp(a)-Math.exp(-a))/2}function h(a){return a*a}if(d)return c.stop(function(){c.optimal(e,f,g)});e=e||.9,f=f||1.42,i?k.coordinate=i:i=k.coordinate.copy();var s=k.pointCoordinate(new b.Point(0,0)).zoomTo(0),v=k.pointCoordinate(k.dimensions).zoomTo(0),w=Math.max(v.column-s.column,v.row-s.row),x=w*Math.pow(2,i.zoom-j.zoom),y=i.zoomTo(0),z=j.zoomTo(0),A={x:y.column,y:y.row},B={x:z.column,y:z.row},C=0,D=Math.sqrt(h(B.x-A.x)+h(B.y-A.y)),E=r(0),F=r(1),G=(F-E)/f,H=function(a){return w*m(E)/m(f*a+E)},I=function(a){return w/h(f)*m(E)*o(f*a+E)-w/h(f)*l(E)+C};if(Math.abs(D)<1e-6){if(Math.abs(w-x)<1e-6)return;var J=x<w?-1:1;G=Math.abs(Math.log(x/w))/f,I=function(a){return C},H=function(a){return w*Math.exp(J*f*a)}}var K=n;n=function(c,d,e,f){if(e==1)return f&&(f.row=j.row,f.column=j.column,f.zoom=j.zoom),j;var g=e*G,h=I(g),i=c.zoom+Math.log(w/H(g))/Math.LN2,k=a(A.x,B.x,h/D||1),l=a(A.y,B.y,h/D||1),m=Math.pow(2,i);if(!f)return new b.Coordinate(l*m,k*m,i);f.row=l*m,f.column=k*m,f.zoom=i},c.run(G/e*1e3,function(a){n=K,g&&g(a)})},c};this.easey=c,typeof this.mapbox=="undefined"&&(this.mapbox={}),this.mapbox.ease=c}(this,MM),function(a,b){function c(a,c){function d(e){var k=Math.max(1,e-o);i&&j?m||(g.x=i.x-j.x,g.y=i.y-j.y,a.panBy(g.x,g.y),m=!0):(f.x*=Math.pow(1-c,k*60/1e3),f.y*=Math.pow(1-c,k*60/1e3),Math.abs(f.x)<.001&&(f.x=0),Math.abs(f.y)<.001&&(f.y=0),(f.x||f.y)&&a.panBy(f.x*k,f.y*k)),o=e,h||b.getFrame(d)}var e={};c=c||.15;var f={x:0,y:0},g={x:0,y:0},h=!1,i=null,j=null,k=null,l=null,m=!0,n,o=(new Date).getTime();return e.down=function(c){i=j=b.getMousePoint(c,a),k=l=+(new Date)},e.move=function(c){i&&(m&&(j=i,l=k,m=!1),i=b.getMousePoint(c,a),k=+(new Date))},e.up=function(){+(new Date)-l<50?(dt=Math.max(1,k-l),g.x=i.x-j.x,g.y=i.y-j.y,f.x=g.x/dt,f.y=g.y/dt):(f.x=0,f.y=0),i=j=null,k=null},e.remove=function(){h=!0},b.getFrame(d),e}var d={};d.TouchHandler=function(){function l(a){b.removeEvent(a.target,"touchmove",g),b.removeEvent(a.target,"touchend",l);var c=(new Date).getTime();a.touches.length===0&&w&&k(a.changedTouches[0]),o.up();for(var d=0;d<a.changedTouches.length;d+=1){var e=a.changedTouches[d],f=u[e.identifier];if(!f||f.wasPinch)continue;var i={x:e.clientX,y:e.clientY},j=c-f.time,m=b.Point.distance(i,f.startPos);m>q||(j>p?(i.end=c,i.duration=j):(i.time=c,h(i)))}var n={};for(var r=0;r<a.touches.length;r++)n[a.touches[r].identifier]=!0;for(var s in u)s in n||delete n[s];return b.cancelEvent(a)}function k(a){var b=n.getZoom(),c=u[a.identifier].startZoom>b?Math.floor(b):Math.ceil(b);easey().map(n).point(x).zoom(c).path("about").run(300),d(),w=!1}function j(a){var c=a.touches[0],d=a.touches[1];y.x=c.clientX,y.y=c.clientY,z.x=d.clientX,z.y=d.clientY,l0=u[c.identifier],l1=u[d.identifier],l0.wasPinch=!0,l1.wasPinch=!0;var e=b.Point.interpolate(y,z,.5);n.zoomByAbout(Math.log(a.scale)/Math.LN2-Math.log(l0.scale)/Math.LN2,e),prevX=l0.x+(l1.x-l0.x)*.5,prevY=l0.y+(l1.y-l0.y)*.5,n.panBy(e.x-prevX,e.y-prevY),w=!0,x=e}function i(a){easey().map(n).to(n.pointCoordinate(a).zoomTo(n.getZoom()+1)).path("about").run(200,function(){n.dispatchCallback("zoomed"),d()})}function h(a){v.length&&a.time-v[0].time<s?(i(a),v=[]):v=[a]}function g(a){switch(a.touches.length){case 1:o.move(a.touches[0]);break;case 2:j(a)}return e(a),b.cancelEvent(a)}function f(a){return o||(o=c(n,.1)),b.addEvent(a.touches[0].target,"touchmove",g),b.addEvent(a.touches[0].target,"touchend",l),a.touches[1]&&(b.addEvent(a.touches[1].target,"touchmove",g),b.addEvent(a.touches[1].target,"touchend",l)),e(a),o.down(a.touches[0]),b.cancelEvent(a)}function e(a){for(var b=0;b<a.touches.length;b+=1){var c=a.touches[b];if(c.identifier in u){var d=u[c.identifier];d.x=c.clientX,d.y=c.clientY,d.scale=a.scale}else u[c.identifier]={scale:a.scale,startPos:{x:c.clientX,y:c.screenY},startZoom:n.zoom(),x:c.clientX,y:c.clientY,time:(new Date).getTime()}}}function d(){for(var a in u)u.hasOwnProperty(a)&&delete u[a]}function a(a){n.parent.focus()}var m={},n,o,p=250,q=30,s=350,u={},v=[],w=!1,x=null,y=new b.Point(0,0),z=new b.Point(0,0);return m.init=function(a){n=a,b.addEvent(n.parent,"touchstart",f)},m.remove=function(){!o||(b.removeEvent(n.parent,"touchstart",f),o.remove())},m},d.DoubleClickHandler=function(){function a(a){var c=b.getMousePoint(a,d);return z=d.getZoom()+(a.shiftKey?-1:1),easey().map(d).to(d.pointCoordinate(b.getMousePoint(a,d)).zoomTo(z)).path("about").run(100,function(){d.dispatchCallback("zoomed")}),b.cancelEvent(a)}var c={},d;return c.init=function(f){return d=f,b.addEvent(d.parent,"dblclick",a),c},c.remove=function(){b.removeEvent(d.parent,"dblclick",a)},c},d.MouseWheelHandler=function(){function a(a){function c(){d.dispatchCallback("zoomed")}var h=0;g=g||(new Date).getTime();try{e.scrollTop=1e3,e.dispatchEvent(a),h=1e3-e.scrollTop}catch(j){h=a.wheelDelta||-a.detail*5}var k=(new Date).getTime()-g;if(!f.running()){var l=b.getMousePoint(a,d),m=d.getZoom();f.map(d).easing("easeOut").to(d.pointCoordinate(b.getMousePoint(a,d)).zoomTo(m+(h>0?1:-1))).path("about").run(100,c),g=(new Date).getTime()}else k>150&&(f.zoom(f.to().zoom+(h>0?1:-1)).from(d.coordinate).resetRun(),g=(new Date).getTime());return b.cancelEvent(a)}var c={},d,e,f=easey(),g,h=!1;return c.init=function(f){d=f,e=document.body.appendChild(document.createElement("div")),e.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var g=e.appendChild(document.createElement("div"));return g.style.height="2000px",b.addEvent(d.parent,"mousewheel",a),c},c.precise=function(a){return arguments.length?(h=a,c):h},c.remove=function(){b.removeEvent(d.parent,"mousewheel",a),e.parentNode.removeChild(e)},c},d.DragHandler=function(){function f(a){return b.removeEvent(document,"mousemove",e),b.removeEvent(document,"mouseup",f),i.up(),h.parent.style.cursor="",b.cancelEvent(a)}function e(a){return i.move(a),b.cancelEvent(a)}function d(a){if(!a.shiftKey&&a.button!=2)return b.addEvent(document,"mousemove",e),b.addEvent(document,"mouseup",f),i.down(a),h.parent.style.cursor="move",b.cancelEvent(a)}function a(a){h.parent.focus()}var g={},h,i;return g.init=function(e){h=e,b.addEvent(h.parent,"click",a),b.addEvent(h.parent,"mousedown",d),i=c(h)},g.remove=function(){b.removeEvent(h.parent,"click",a),b.removeEvent(h.parent,"mousedown",d),i.up(),i.remove()},g},this.easey_handlers=d}(this,MM),typeof mapbox=="undefined"&&(mapbox={}),typeof mapbox.markers=="undefined"&&(mapbox.markers={}),mapbox.markers.layer=function(){function a(a){a.coord||(a.coord=b.map.locationCoordinate(a.location));var c=b.map.coordinatePoint(a.coord),d,e;c.x<0?(d=new MM.Location(a.location.lat,a.location.lon),d.lon+=Math.ceil((j.lon-a.location.lon)/360)*360,e=b.map.locationPoint(d),e.x<b.map.dimensions.x&&(c=e,a.coord=b.map.locationCoordinate(d))):c.x>b.map.dimensions.x&&(d=new MM.Location(a.location.lat,a.location.lon),d.lon-=Math.ceil((a.location.lon-k.lon)/360)*360,e=b.map.locationPoint(d),e.x>0&&(c=e,a.coord=b.map.locationCoordinate(d))),c.scale=1,c.width=c.height=0,MM.moveElement(a.element,c)}var b={},c=[],d=[],e=new MM.CallbackManager(b,["drawn","markeradded"]),f=null,g=mapbox.markers.simplestyle_factory,h=function(a,b){return b.geometry.coordinates[1]-a.geometry.coordinates[1]},i,j=null,k=null,l=function(){return!0},m=0,n=function(){return++m},o={};return b.parent=document.createElement("div"),b.parent.style.cssText="position: absolute; top: 0px;left:0px; width:100%; height:100%; margin:0; padding:0; z-index:0;pointer-events:none;",b.name="markers",b.addCallback=function(a,c){return e.addCallback(a,c),b},b.removeCallback=function(a,c){return e.removeCallback(a,c),b},b.draw=function(){if(!!b.map){j=b.map.pointLocation(new MM.Point(0,0)),k=b.map.pointLocation(new MM.Point(b.map.dimensions.x,0)),e.dispatchCallback("drawn",b);for(var c=0;c<d.length;c++)a(d[c])}},b.add=function(a){return!a||!a.element?null:(b.parent.appendChild(a.element),d.push(a),e.dispatchCallback("markeradded",a),a)},b.remove=function(a){if(!a)return null;b.parent.removeChild(a.element);for(var c=0;c<d.length;c++)if(d[c]===a)return d.splice(c,1),a;return a},b.markers=function(a){if(!arguments.length)return d},b.add_feature=function(a){return b.features(b.features().concat([a]))},b.sort=function(a){return arguments.length?(h=a,b):h},b.features=function(e){if(!arguments.length)return c;e||(e=[]),c=e.slice(),c.sort(h);for(var f=0;f<d.length;f++)d[f].touch=!1;for(var i=0;i<c.length;i++)if(l(c[i])){var j=n(c[i]);o[j]?(o[j].location=new MM.Location(c[i].geometry.coordinates[1],c[i].geometry.coordinates[0]),o[j].coord=null,a(o[j])):o[j]=b.add({element:g(c[i]),location:new MM.Location(c[i].geometry.coordinates[1],c[i].geometry.coordinates[0]),data:c[i]}),o[j]&&(o[j].touch=!0)}for(var k=d.length-1;k>=0;k--)d[k].touch===!1&&b.remove(d[k]);return b.map&&b.map.coordinate&&b.map.draw(),b},b.url=function(a,c){function d(a,d){if(a&&c)return c(a);var e=typeof d!="undefined"&&d.features?d.features:null;e&&b.features(e),c&&c(a,e,b)}if(!arguments.length)return i;if(typeof reqwest=="undefined")throw"reqwest is required for url loading";return typeof a=="string"&&(a=[a]),i=a,reqwest(i[0].match(/geojsonp$/)?{url:i[0]+(~i[0].indexOf("?")?"&":"?")+"callback=?",type:"jsonp",success:function(a){d(null,a)},error:d}:{url:i[0],type:"json",success:function(a){d(null,a)},error:d}),b},b.id=function(a,c){return b.url("http://a.tiles.mapbox.com/v3/"+a+"/markers.geojsonp",c)},b.csv=function(a){return b.features(mapbox.markers.csv_to_geojson(a))},b.extent=function(){var a=[{lat:Infinity,lon:Infinity},{lat:-Infinity,lon:-Infinity}],c=b.features();for(var d=0;d<c.length;d++){var e=c[d].geometry.coordinates;e[0]<a[0].lon&&(a[0].lon=e[0]),e[1]<a[0].lat&&(a[0].lat=e[1]),e[0]>a[1].lon&&(a[1].lon=e[0]),e[1]>a[1].lat&&(a[1].lat=e[1])}return a},b.key=function(a){return arguments.length?(a===null?n=function(){return++m}:n=a,b):n},b.factory=function(a){return arguments.length?(g=a,b.features(b.features()),b):g},b.filter=function(a){return arguments.length?(l=a,b.features(b.features()),b):l},b.destroy=function(){b.parent.parentNode&&b.parent.parentNode.removeChild(b.parent)},b.named=function(a){return arguments.length?(b.name=a,b):b.name},b.enabled=!0,b.enable=function(){return this.enabled=!0,this.parent.style.display="",b},b.disable=function(){return this.enabled=!1,this.parent.style.display="none",b},b},mmg=mapbox.markers.layer,mapbox.markers.interaction=function(a){function b(){a.map.addCallback("panned",function(){if(f)while(d.length)a.remove(d.pop())})}if(a&&a.interaction)return a.interaction;var c={},d=[],e=!0,f=!0,g=!0,h=null,i=!0,j;c.formatter=function(a){return arguments.length?(j=a,c):j},c.formatter(function(a){var b="",c=a.properties;return c?(c.title&&(b+='<div class="marker-title">'+c.title+"</div>"),c.description&&(b+='<div class="marker-description">'+c.description+"</div>"),typeof html_sanitize!==undefined&&(b=html_sanitize(b,function(a){if(/^(https?:\/\/|data:image)/.test(a))return a},function(a){return a})),b):null}),c.hideOnMove=function(a){return arguments.length?(f=a,c):f},c.exclusive=function(a){return arguments.length?(e=a,c):e},c.showOnHover=function(a){return arguments.length?(g=a,c):g},c.hideTooltips=function(){while(d.length)a.remove(d.pop());for(var b=0;b<k.length;b++)delete k[b].clicked},c.add=function(){return i=!0,c},c.remove=function(){return i=!1,c},c.bindMarker=function(b){var f=function(){g!==!1&&(b.clicked||(h=window.setTimeout(function(){c.hideTooltips()},200)))},k=function(k){function l(a){return a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation(),!1}if(!k||k.type!="mouseover"||g!==!1){if(!i)return;var m=j(b.data);if(!m)return;e&&d.length>0&&(c.hideTooltips(),h&&window.clearTimeout(h));var p=document.createElement("div");p.className="marker-tooltip",p.style.width="100%";var q=p.appendChild(document.createElement("div"));q.style.cssText="position: absolute; pointer-events: none;";var v=q.appendChild(document.createElement("div"));v.className="marker-popup",v.style.cssText="pointer-events: auto;",typeof m=="string"?v.innerHTML=m:v.appendChild(m),q.style.bottom=b.element.offsetHeight/2+20+"px",MM.addEvent(v,"mousedown",l),MM.addEvent(v,"touchstart",l),g&&(p.onmouseover=function(){h&&window.clearTimeout(h)},p.onmouseout=f);var w={element:p,data:{},interactive:!1,location:b.location.copy()};d.push(w),b.tooltip=w,a.add(w),a.draw()}};b.showTooltip=k,b.element.onclick=b.element.ontouchstart=function(){k(),b.clicked=!0},b.element.onmouseover=k,b.element.onmouseout=f};if(a){a.addCallback("drawn",b);var k=a.markers();for(var l=0;l<k.length;l++)c.bindMarker(k[l]);a.addCallback("markeradded",function(a,b){b.interactive!==!1&&c.bindMarker(b)}),a.interaction=c}return c},mmg_interaction=mapbox.markers.interaction,mapbox.markers.csv_to_geojson=function(a){function c(a,b){function c(){if(g.lastIndex>=a.length)return e;if(j)return j=!1,d;var b=g.lastIndex;if(a.charCodeAt(b)===34){var c=b;while(c++<a.length)if(a.charCodeAt(c)===34){if(a.charCodeAt(c+1)!==34)break;c++}g.lastIndex=c+2;var f=a.charCodeAt(c+1);return f===13?(j=!0,a.charCodeAt(c+2)===10&&g.lastIndex++):f===10&&(j=!0),a.substring(b+1,c).replace(/""/g,'"')}var h=g.exec(a);return h?(j=h[0].charCodeAt(0)!==44,a.substring(b,h.index)):(g.lastIndex=a.length,a.substring(b))}var d={},e={},f=[],g=/\r\n|[,\r\n]/g,h=0,i,j;g.lastIndex=0;while((i=c())!==e){var k=[];while(i!==d&&i!==e)k.push(i),i=c();if(b&&!(k=b(k,h++)))continue;f.push(k)}return f}function b(a){var b;return c(a,function(a,c){if(c){var d={},e=-1,f=b.length;while(++e<f)d[b[e]]=a[e];return d}return b=a,null})}var d=[],e=b(a);if(!e.length)return d;var f="",g="";for(var h in e[0])h.match(/^Lat/i)&&(f=h),h.match(/^Lon/i)&&(g=h);if(!f||!g)throw"CSV: Could not find latitude or longitude field";for(var i=0;i<e.length;i++)e[i][g]!==undefined&&e[i][g]!==undefined&&d.push({type:"Feature",properties:e[i],geometry:{type:"Point",coordinates:[parseFloat(e[i][g]),parseFloat(e[i][f])]}});return d},mapbox.markers.simplestyle_factory=function(a){var b={small:[20,50],medium:[30,70],large:[35,90]},c=a.properties||{},d=c["marker-size"]||"medium",e=c["marker-symbol"]?"-"+c["marker-symbol"]:"",f=c["marker-color"]||"7e7e7e";f=f.replace("#","");var g=document.createElement("img");g.width=b[d][0],g.height=b[d][1],g.className="simplestyle-marker",g.alt=c.title||"",g.src=(mapbox.markers.marker_baseurl||"http://a.tiles.mapbox.com/v3/marker/")+"pin-"+d.charAt(0)+e+"+"+f+(window.devicePixelRatio===2?"@2x":"")+".png";var h=g.style;return h.position="absolute",h.clip="rect(auto auto "+b[d][1]*.75+"px auto)",h.marginTop=-(b[d][1]/2)+"px",h.marginLeft=-(b[d][0]/2)+"px",h.cursor="pointer",h.pointerEvents="all",g},typeof mapbox=="undefined"&&(mapbox={}),mapbox.MAPBOX_URL="http://a.tiles.mapbox.com/v3/",mapbox.map=function(a,b,c,d){var e=new MM.Map(a,b,c,d||[easey_handlers.TouchHandler(),easey_handlers.DragHandler(),easey_handlers.DoubleClickHandler(),easey_handlers.MouseWheelHandler()]);e.setZoomRange(0,17),e.ease=easey().map(e),e.ui=mapbox.ui(e),e.interaction=mapbox.interaction().map(e),e.auto=function(){this.ui.zoomer.add(),this.ui.zoombox.add(),this.ui.legend.add(),this.ui.attribution.add(),this.ui.refresh(),this.interaction.auto();for(var a=0;a<this.layers.length;a++)if(this.layers[a].tilejson){var b=this.layers[a].tilejson(),c=b.center||new MM.Location(0,0),d=b.zoom||0;this.setCenterZoom(c,d);break}return this},e.refresh=function(){return this.ui.refresh(),this.interaction.refresh(),this};var f=[easey_handlers.TouchHandler,easey_handlers.DragHandler,easey_handlers.DoubleClickHandler,easey_handlers.MouseWheelHandler],g=[MM.TouchHandler,MM.DragHandler,MM.DoubleClickHandler,MM.MouseWheelHandler];return MM.Map.prototype.smooth=function(a){while(this.eventHandlers.length)this.eventHandlers.pop().remove();var b=a?f:g;for(var c=0;c<b.length;c++){var d=b[c]();this.eventHandlers.push(d),d.init(this)}return e},e.setPanLimits=function(a){return a instanceof MM.Extent||(a=new MM.Extent(new MM.Location(a[0].lat,a[0].lon),new MM.Location(a[1].lat,a[1].lon))),a=a.toArray(),this.coordLimits=[this.locationCoordinate(a[0]).zoomTo(this.coordLimits[0].zoom),this.locationCoordinate(a[1]).zoomTo(this.coordLimits[1].zoom)],e},e.center=function(a,b){if(!a||!b)return MM.Map.prototype.center.call(this,a);this.ease.location(a).zoom(this.zoom()).optimal(null,null,b.callback)},e.zoom=function(a,b){if(a===undefined||!b)return MM.Map.prototype.zoom.call(this,a);this.ease.to(this.coordinate).zoom(a).run(600)},e.centerzoom=function(a,b,c){if(a&&b!==undefined&&c)this.ease.location(a).zoom(b).optimal(null,null,c.callback);else if(a&&b!==undefined)return this.setCenterZoom(a,b)},e.addTileLayer=function(a){for(var b=e.layers.length;b>0;b--)if(!e.layers[b-1].features)return this.insertLayerAt(b,a);return this.insertLayerAt(0,a)},e.removeLayerAt=function(a){return MM.Map.prototype.removeLayerAt.call(this,a),MM.getFrame(this.getRedraw()),this},e.swapLayersAt=function(a,b){return MM.Map.prototype.swapLayersAt.call(this,a,b),MM.getFrame(this.getRedraw()),this},e},this.mapbox=mapbox,typeof mapbox=="undefined"&&(mapbox={}),mapbox.auto=function(a,b,c){mapbox.load(b,function(b){var d=b instanceof Array?b:[b],f=[],g=[];for(var h=0;h<d.length;h++)d[h].layer&&f.push(d[h].layer),d[h].markers&&g.push(d[h].markers);var i=mapbox.map(a,f.concat(g)).auto();c&&c(i,b)})},mapbox.load=function(a,b){if(a instanceof Array)return mapbox.util.asyncMap(a,mapbox.load,b);a.indexOf("http")!==0&&(a=mapbox.MAPBOX_URL+a+".jsonp"),wax.tilejson(a,function(a){a.zoom=a.center[2],a.center={lat:a.center[1],lon:a.center[0]},a.thumbnail=mapbox.MAPBOX_URL+a.id+"/thumb.png",a.layer=mapbox.layer().tilejson(a),a.data?(a.markers=mapbox.markers.layer(),a.markers.url(a.data,function(){mapbox.markers.interaction(a.markers),b(a)})):b(a)})},typeof mapbox=="undefined"&&(mapbox={}),mapbox.layer=function(){if(!(this instanceof mapbox.layer))return new mapbox.layer;this._tilejson={},this._url="",this._id="",this._composite=!0,this.name="",this.parent=document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.levels={},this.requestManager=new MM.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),this.setProvider(new wax.mm._provider({tiles:["data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"]}))},mapbox.layer.prototype.refresh=function(a){var b=this;return wax.tilejson(this._url,function(c){b.tilejson(c),a&&a(b)}),this},mapbox.layer.prototype.url=function(a,b){return arguments.length?(this._mapboxhosting=a.indexOf(mapbox.MAPBOX_URL)==0,this._url=a,this.refresh(b)):this._url},mapbox.layer.prototype.id=function(a,b){return arguments.length?(this.named(a),this._id=a,this.url(mapbox.MAPBOX_URL+a+".jsonp",b)):this._id},mapbox.layer.prototype.named=function(a){return arguments.length?(this.name=a,this):this.name},mapbox.layer.prototype.tilejson=function(a){if(!arguments.length)return this._tilejson;(!this._composite||!this._mapboxhosting)&&this.setProvider(new wax.mm._provider(a)),this._tilejson=a,this.name=this.name||a.id,this._id=this._id||a.id;if(a.bounds){var b=new MM.MercatorProjection(0,MM.deriveTransformation(-Math.PI,Math.PI,0,0,Math.PI,Math.PI,1,0,-Math.PI,-Math.PI,0,1));this.provider.tileLimits=[b.locationCoordinate(new MM.Location(a.bounds[3],a.bounds[0])).zoomTo(a.minzoom?a.minzoom:0),b.locationCoordinate(new MM.Location(a.bounds[1],a.bounds[2])).zoomTo(a.maxzoom?a.maxzoom:18)]}return this},mapbox.layer.prototype.draw=function(){if(!!this.enabled&&!!this.map){if(this._composite&&this._mapboxhosting){var a=0;for(a;a<this.map.layers.length;a++)if(this.map.layers[a]==this)break;for(var b=a-1;b>=0;b--)if(this.map.getLayerAt(b).enabled){if(this.map.getLayerAt(b)._composite)return this.parent.style.display="none",this.compositeLayer=!1,this;break}var c=[];for(var d=a;d<this.map.layers.length;d++){var e=this.map.getLayerAt(d);if(e.enabled){if(!e._composite||!e._mapboxhosting)break;c.push(e.id())}}c=c.join(",");if(this.compositeLayer!==c){this.compositeLayer=c;var f=this;return wax.tilejson(mapbox.MAPBOX_URL+c+".jsonp",function(a){f.setProvider(new wax.mm._provider(a))}),this.parent.style.display="",this}}else this.parent.style.display="",this.compositeLayer&&(this.compositeLayer=!1,this.setProvider(new wax.mm._provider(this.tilejson())));return MM.Layer.prototype.draw.call(this)}},mapbox.layer.prototype.composite=function(a){return arguments.length?(a?this._composite=!0:this._composite=!1,this):this._composite},mapbox.layer.prototype.enable=function(a){return MM.Layer.prototype.enable.call(this,a),this.map&&this.map.draw(),this},mapbox.layer.prototype.disable=function(a){return MM.Layer.prototype.disable.call(this,a),this.map&&this.map.draw(),this},MM.extend(mapbox.layer,MM.Layer),typeof mapbox=="undefined"&&(mapbox={}),mapbox.ui=function(a){function b(a){var b={},c=[];for(var d=0;d<a.length;d++)b[a[d]]=!0;for(var e in b)e&&c.push(e);return c}var c={zoomer:wax.mm.zoomer().map(a).smooth(!0),pointselector:wax.mm.pointselector().map(a),hash:wax.mm.hash().map(a),zoombox:wax.mm.zoombox().map(a),fullscreen:wax.mm.fullscreen().map(a),legend:wax.mm.legend().map(a),attribution:wax.mm.attribution().map(a)};return c.refresh=function(){if(!a)return console&&console.error("ui not attached to map");var d=[],f=[];for(var g=0;g<a.layers.length;g++)if(a.layers[g].enabled&&a.layers[g].tilejson){var h=a.layers[g].tilejson().attribution;h&&d.push(h);var i=a.layers[g].tilejson().legend;i&&f.push(i)}var j=b(d),k=b(f);c.attribution.content(j.length?j.join("<br />"):""),c.legend.content(k.length?k.join("<br />"):""),c.attribution.element().style.display=j.length?"":"none",c.legend.element().style.display=k.length?"":"none"},c},typeof mapbox=="undefined"&&(mapbox={}),mapbox.interaction=function(){var a=wax.mm.interaction(),b=!1;return a.refresh=function(){var c=a.map();if(!b||!c)return a;for(var d=c.layers.length-1;d>=0;d--)if(c.layers[d].enabled){var f=c.layers[d].tilejson&&c.layers[d].tilejson();if(f&&f.template)return a.tilejson(f)}return a.tilejson({})},a.auto=function(){return b=!0,a.on(wax.tooltip().animate(!0).parent(a.map().parent).events()).on(wax.location().events()),a.refresh()},a},typeof mapbox=="undefined"&&(mapbox={}),mapbox.util={asyncMap:function(a,b,c){function d(a){return function(b){f[a]=b,e--,e||c(f)}}var e=a.length,f=[];for(var g=0;g<a.length;g++)b(a[g],d(g))}},function(a){function c(a,b){if(a===b)return!0;var c=b.parentNode;while(c!==null){if(c===a)return!0;c=c.parentNode}return!1}var b={};b.blockScrollInto=function(a){function d(d){c(a,d.target)?b&&d.stopPropagation():b=!0}var b=!0;if(!window.addEventListener)return this;window.addEventListener("mousewheel",d,!0),window.addEventListener("DOMMouseScroll",d,!0),a.addEventListener("mousemove",function(c){b=!1},!1);return this},this.deadsea=b}(this),wax=wax||{},wax.g=wax.g||{},wax.mm=wax.mm||{},wax.mm.geocoder=function(a,b){if(!b||!b.geocoder)return{appendTo:function(a){return this}};var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("form"),f=document.createElement("div"),g=document.createElement("input"),h=document.createElement("a"),i=null,j=[h,g,d,f],k=null,l={},m=500,n="";if(typeof com!="undefined")for(var o=0;o<j.length;o++)MM.addEvent(j[o],"mousedown",function(a){MM.cancelEvent(a)}),MM.addEvent(j[o],"dblclick",function(a){MM.cancelEvent(a)});var p=function(){c.className="map-spotlight";return!1},q=function(){while(f.hasChildNodes())f.removeChild(f.lastChild);f.className="results",i=null;return!1},r=function(){q(),f.innerHTML="<span>No results</span>",f.className="results items";return!1},s=function(b){b.length===3?a.setCenterZoom(new MM.Location(b[1],b[0]),b[2]):a.setCenter(new MM.Location(b[1],b[0])),c.className="map-spotlight active";return!1},t={city:12,town:13,village:14,hamlet:15},u=function(c){if(c.bounds){var d=a.extentCoordinate([new MM.Location(c.bounds[1],c.bounds[0]),new MM.Location(c.bounds[3],c.bounds[2])]).zoom;d=d<=b.minzoom?b.minzoom:d-1;return[c.lon,c.lat,d]}return"city,town,village,hamlet".indexOf(c.type)>=0?[c.lon,c.lat,t[c.type]]:[c.lon,c.lat]};h.className="geocode",h.innerHTML="Geocode",h.href="#geocode",h.onclick=h.ontouchstart=function(){d.className.indexOf("active")>0?(d.className="map-geocoder",c.className="map-spotlight"):d.className="map-geocoder active",g.focus();return!1},g.type="text",g.placeholder="Search",g.onclick=function(){g.focus()},e.className="search",e.appendChild(g);var v=function(a,c){if(!a)return q();c&&(l={}),l[a]=function(b,e){delete l[a],d.className="map-geocoder active";if(b||e.results.length===0)return r();q(),c&&s(u(e.results[0][0]));var g=0;for(var h=0,j=Math.min(e.results.length,5);h<j;h++){var k=document.createElement("a"),m=[];for(var n=0;n<e.results[h].length;n++)e.results[h][n].name&&m.push(e.results[h][n].name);if(!m.length)continue;g++,k.innerHTML=m.join(", "),k.href="#"+u(e.results[h][0]).join(","),k.onclick=function(a){var b=a?a.currentTarget:window.event.srcElement;i&&(i.className=""),i=b,i.className="selected",s(b.href.split("#").pop().split(","));return!1},f.appendChild(k)}if(e.results.length>5&&g===5){var o=document.createElement("span");o.innerHTML="Top "+g+" of "+e.results.length+" results",f.appendChild(o)}g&&(f.className="results items")},d.className="map-geocoder active searching",wax.request.get(b.geocoder.replace("{query}",a),function(b,c){l[a]&&l[a](b,c)});return!1};g.onkeydown=function(a){a=a||window.event;var b=a&&(a.which||a.keyCode);switch(b){case 38:i&&(i.className=""),i=i?i.previousSibling?i.previousSibling:f.lastChild:f.lastChild,i&&(i.className="selected");return!1;case 40:i&&(i.className=""),i=i?i.nextSibling?i.nextSibling:f.firstChild:f.firstChild,i&&(i.className="selected");return!1;case 27:q()}},g.onkeyup=function(){var a=g.value;!a||a===n||a.length<3||(n=a,clearTimeout(k),k=setTimeout(function(){k=null,v(a+"*")},m))},e.onsubmit=function(){clearTimeout(k);if(i){s(i.href.split("#").pop().split(","));return!1}return v(g.value,!0)},f.className="results",d.className="map-geocoder",d.appendChild(h),d.appendChild(e),d.appendChild(f),p(),a.addCallback("panned",p),a.addCallback("zoomed",p),a.addCallback("extentset",p),a.addCallback("centered",p);return{appendTo:function(a){wax.u.$(a).appendChild(d),wax.u.$(a).appendChild(c);return this}}},wax.g.share=wax.mm.share=function(a,b){b=b||{},b.webpage=b.webpage||window.location,b.embed=b.embed||window.location;var c=document.createElement("a"),d=document.createElement("a"),e=document.createElement("textarea"),f=document.createElement("div"),g=document.createElement("div"),h=[c,d,e,f,g];if(typeof com!="undefined"){var i=com.modestmaps;for(var j=0;j<h.length;j++)MM.addEvent(h[j],"mousedown",function(a){MM.cancelEvent(a)}),MM.addEvent(h[j],"dblclick",function(a){MM.cancelEvent(a)})}c.innerHTML="Share +",c.href="#",c.className="share",c.onclick=c.ontouchstart=function(){g.style.display=g.style.display==="block"?"none":"block";return!1},d.innerHTML="Close",d.href="#",d.className="close",d.onclick=d.ontouchstart=function(){g.style.display=g.style.display==="block"?"none":"block";return!1},e.className="embed",e.rows=4,e.value="<iframe width='500' height='300' frameBorder='0' src='{{embed}}'></iframe>".replace("{{embed}}",b.embed),e.onclick=function(){e.focus(),e.select();return!1};var k="http://twitter.com/intent/tweet?status="+encodeURIComponent(b.name+" ("+b.webpage+")"),l="https://www.facebook.com/sharer.php?u="+encodeURIComponent(b.webpage)+"&t="+encodeURIComponent(b.name);f.innerHTML="<h3>Share this map</h3><p><a class='facebook' target='_blank' href='{{facebook}}'>Facebook</a><a class='twitter' target='_blank' href='{{twitter}}'>Twitter</a></p>".replace("{{twitter}}",k).replace("{{facebook}}",l),f.innerHTML+="<strong>Get the embed code</strong><br />",f.innerHTML+="<small>Copy and paste this HTML into your website or blog.</small>",f.appendChild(e),f.appendChild(d),g.className="map-share",g.style.display="none",g.appendChild(f);return{appendTo:function(a){wax.u.$(a).appendChild(c),wax.u.$(a).appendChild(g);return this}}},window.tilejson&&(window.onload=function(){deadsea.blockScrollInto(document.body);var a=window.tilejson,b=a.options.join(" "),c=function(a){return b.indexOf(a)>=0},d=function(a,b){var c=a?easey_handlers:MM;return[c.TouchHandler(),c.DragHandler(),c.DoubleClickHandler()].concat(b?[c.MouseWheelHandler()]:[])}(navigator.appName!=="Microsoft Internet Explorer",c("zoomwheel")),e=mapbox.map("map",mapbox.layer().tilejson(a),null,d);if(a.data){var f=mapbox.markers.layer();e.addLayer(f),mapbox.markers.interaction(f),f.url(a.data)}c("zoompan")&&e.ui.zoomer.add(),c("legend")&&e.ui.legend.add(),c("tooltips")&&e.interaction.auto().on(wax.location().events()),c("zoombox")&&e.ui.zoombox.add(),c("attribution")&&e.ui.attribution.add(),c("share")&&wax.mm.share(e,a).appendTo(e.parent),c("geocoder")&&wax.mm.geocoder(e,a).appendTo(e.parent),e.centerzoom({lat:a.center[1],lon:a.center[0]},a.center[2]),e.setZoomRange(a.minzoom,a.maxzoom),e.ui.hash.add(),e.ui.refresh()})